import{createAudioContext as e}from"../../../../../../../node_modules/cm-web-modules/src/audio/Audio.js";import{Sample as t}from"../../../../../../../node_modules/cm-web-modules/src/audio/Sample.js";const s="8/8/8/8/8/8/8/8";class i{constructor(e=s){this.squares=new Array(64).fill(null),this.setFen(e)}setFen(e=s){const t=e.replace(/^\s*/,"").replace(/\s*$/,"").split(/\/|\s/);for(let e=0;e<8;e++){const s=t[7-e].replace(/\d/g,e=>{const t=parseInt(e);let s="";for(let e=0;e<t;e++)s+="-";return s});for(let t=0;t<8;t++){const i=s.substring(t,t+1);let r=null;"-"!==i&&(r=i.toUpperCase()===i?`w${i.toLowerCase()}`:`b${i}`),this.squares[8*e+t]=r}}}getFen(){let e=new Array(8).fill("");for(let t=0;t<8;t++){let s=0;for(let i=0;i<8;i++){const r=this.squares[8*t+i];if(r){s>0&&(e[7-t]+=s,s=0);const i=r.substring(0,1),o=r.substring(1,2);e[7-t]+="w"===i?o.toUpperCase():o}else s++}s>0&&(e[7-t]+=s,s=0)}return e.join("/")}getPieces(e=void 0,t=void 0,s=["k","q","r","b","n","p"]){const r=[],o=(e,t)=>s.indexOf(e.name)-s.indexOf(t.name);for(let s=0;s<64;s++){const o=this.squares[s];if(o){const a=o.charAt(1),n=o.charAt(0),h=i.indexToSquare(s);if(t&&t!==a||e&&e!==n)continue;r.push({name:a,type:a,color:n,position:h,square:h})}}return s&&r.sort(o),r}movePiece(e,t){this.squares[i.squareToIndex(e)]?(this.squares[i.squareToIndex(t)]=this.squares[i.squareToIndex(e)],this.squares[i.squareToIndex(e)]=null):console.warn("no piece on",e)}setPiece(e,t){this.squares[i.squareToIndex(e)]=t}getPiece(e){return this.squares[i.squareToIndex(e)]}static squareToIndex(e){const t=i.squareToCoordinates(e);return t[0]+8*t[1]}static indexToSquare(e){return this.coordinatesToSquare([Math.floor(e%8),e/8])}static squareToCoordinates(e){return[e.charCodeAt(0)-97,e.charCodeAt(1)-49]}static coordinatesToSquare(e){return String.fromCharCode(e[0]+97)+String.fromCharCode(e[1]+49)}toString(){return this.getFen()}clone(){const e=new i;return e.squares=this.squares.slice(0),e}}class r{constructor(){this.position=new i,this.orientation=void 0,this.inputWhiteEnabled=!1,this.inputBlackEnabled=!1,this.squareSelectEnabled=!1,this.moveInputCallback=null,this.extensionPoints={},this.moveInputProcess=Promise.resolve()}inputEnabled(){return this.inputWhiteEnabled||this.inputBlackEnabled}invokeExtensionPoints(e,t={}){const s=this.extensionPoints[e],i=Object.assign({},t);i.extensionPoint=e;let r=!0;if(s)for(const e of s)!1===e(i)&&(r=!1);return r}}const o="http://www.w3.org/2000/svg";class a{static createSvg(e=void 0){let t=document.createElementNS(o,"svg");return e&&(t.setAttribute("width","100%"),t.setAttribute("height","100%"),e.appendChild(t)),t}static addElement(e,t,s={}){let i=document.createElementNS(o,t);"use"===t&&(s["xlink:href"]=s.href);for(let e in s)if(s.hasOwnProperty(e))if(-1!==e.indexOf(":")){const t=e.split(":");i.setAttributeNS("http://www.w3.org/1999/"+t[0],t[1],s[e])}else i.setAttribute(e,s[e]);return e.appendChild(i),i}static removeElement(e){e?e.parentNode?e.parentNode.removeChild(e):console.warn(e,"without parentNode"):console.warn("removeElement, element is",e)}}const n="positionChanged",h="boardChanged",c="moveInputToggled",l="moveInput",d="beforeRedrawBoard",u="afterRedrawBoard",p="redrawBoard",v="animation",b="destroy";class m{constructor(e){this.chessboard=e}registerExtensionPoint(e,t){e===p&&(console.warn("EXTENSION_POINT.redrawBoard is deprecated, use EXTENSION_POINT.afterRedrawBoard"),e=u),this.chessboard.state.extensionPoints[e]||(this.chessboard.state.extensionPoints[e]=[]),this.chessboard.state.extensionPoints[e].push(t)}registerMethod(e,t){console.warn("registerMethod is deprecated, just add methods directly to the chessboard instance"),this.chessboard[e]?log.error("method",e,"already exists"):this.chessboard[e]=(...e)=>t.apply(this,e)}}class P{static delegate(e,t,s,i){const r=function(e){let t=e.target;for(;t&&t!==this;)t.matches(s)&&i.call(t,e),t=t.parentNode};return e.addEventListener(t,r),{remove:function(){e.removeEventListener(t,r)}}}static mergeObjects(e,t){const s=e=>e&&"object"==typeof e;if(!s(e)||!s(t))return t;for(const s of Object.keys(t))t[s]instanceof Object&&Object.assign(t[s],P.mergeObjects(e[s],t[s]));return Object.assign(e||{},t),e}static createDomElement(e){const t=document.createElement("template");return t.innerHTML=e.trim(),t.content.firstChild}static createTask(){let e,t;const s=new Promise(function(s,i){e=s,t=i});return s.resolve=e,s.reject=t,s}static isAbsoluteUrl(e){return-1!==e.indexOf("://")||e.startsWith("/")}}const g="start",w="frame",S="end";class f{constructor(){this.queue=[],this.workingOnPromise=!1,this.stop=!1}async enqueue(e){return new Promise((t,s)=>{this.queue.push({promise:e,resolve:t,reject:s}),this.dequeue()})}dequeue(){if(this.workingOnPromise)return;if(this.stop)return this.queue=[],void(this.stop=!1);const e=this.queue.shift();if(e){try{this.workingOnPromise=!0,e.promise().then(t=>{this.workingOnPromise=!1,e.resolve(t),this.dequeue()}).catch(t=>{this.workingOnPromise=!1,e.reject(t),this.dequeue()})}catch(t){this.workingOnPromise=!1,e.reject(t),this.dequeue()}return!0}}destroy(){this.stop=!0}}const k=0,q=1,y=2;class I{constructor(e,t,s,i,r){this.view=e,t&&s?(this.animatedElements=this.createAnimation(t.squares,s.squares),this.duration=i,this.callback=r,this.frameHandle=requestAnimationFrame(this.animationStep.bind(this))):console.error("fromPosition",t,"toPosition",s),this.view.positionsAnimationTask=P.createTask(),this.view.chessboard.state.invokeExtensionPoints(v,{type:g})}static seekChanges(e,t){const s=[],i=[],r=[];for(let r=0;r<64;r++){const o=e[r],a=t[r];a!==o&&(a&&s.push({piece:a,index:r}),o&&i.push({piece:o,index:r}))}return s.forEach(e=>{let t=8,s=null;i.forEach(i=>{if(e.piece===i.piece){const r=I.squareDistance(e.index,i.index);r<t&&(s=i,t=r)}}),s?(i.splice(i.indexOf(s),1),r.push({type:k,piece:e.piece,atIndex:s.index,toIndex:e.index})):r.push({type:q,piece:e.piece,atIndex:e.index})}),i.forEach(e=>{r.push({type:y,piece:e.piece,atIndex:e.index})}),r}createAnimation(e,t){const s=I.seekChanges(e,t),r=[];return s.forEach(e=>{const t={type:e.type};switch(e.type){case k:t.element=this.view.getPieceElement(i.indexToSquare(e.atIndex)),t.element.parentNode.appendChild(t.element),t.atPoint=this.view.indexToPoint(e.atIndex),t.toPoint=this.view.indexToPoint(e.toIndex);break;case q:t.element=this.view.drawPieceOnSquare(i.indexToSquare(e.atIndex),e.piece),t.element.style.opacity=0;break;case y:t.element=this.view.getPieceElement(i.indexToSquare(e.atIndex))}r.push(t)}),r}animationStep(e){if(!this.view||!this.view.chessboard.state)return;this.startTime||(this.startTime=e);const t=e-this.startTime;if(!(t<=this.duration))return cancelAnimationFrame(this.frameHandle),this.animatedElements.forEach(e=>{e.type===y&&a.removeElement(e.element)}),this.view.positionsAnimationTask.resolve(),this.view.chessboard.state.invokeExtensionPoints(v,{type:S}),void this.callback();this.frameHandle=requestAnimationFrame(this.animationStep.bind(this));const s=Math.min(1,t/this.duration);let i=s<.5?2*s*s:(4-2*s)*s-1;(isNaN(i)||i>.99)&&(i=1),this.animatedElements.forEach(e=>{if(e.element)switch(e.type){case k:e.element.transform.baseVal.removeItem(0);const t=this.view.svg.createSVGTransform();t.setTranslate(e.atPoint.x+(e.toPoint.x-e.atPoint.x)*i,e.atPoint.y+(e.toPoint.y-e.atPoint.y)*i),e.element.transform.baseVal.appendItem(t);break;case q:e.element.style.opacity=Math.round(100*i)/100;break;case y:e.element.style.opacity=Math.round(100*(1-i))/100}else console.warn("animatedItem has no element",e)}),this.view.chessboard.state.invokeExtensionPoints(v,{type:w,progress:i})}static squareDistance(e,t){const s=e%8,i=Math.floor(e/8),r=t%8,o=Math.floor(t/8);return Math.max(Math.abs(o-i),Math.abs(r-s))}}class M extends f{constructor(e){super(),this.chessboard=e}async enqueuePositionChange(e,t,s){return e.getFen()===t.getFen()?Promise.resolve():super.enqueue(()=>new Promise(i=>{let r=s?this.chessboard.props.style.animationDuration:0;this.queue.length>0&&(r/=1+Math.pow(this.queue.length/5,2)),new I(this.chessboard.view,e,t,s?r:0,()=>{this.chessboard.view&&this.chessboard.view.redrawPieces(t.squares),i()})}))}async enqueueTurnBoard(e,t,r){return super.enqueue(()=>new Promise(o=>{const a=new i(s);let n=r?this.chessboard.props.style.animationDuration:0;this.queue.length>0&&(n/=1+Math.pow(this.queue.length/5,2)),new I(this.chessboard.view,e,a,r?n:0,()=>{this.chessboard.state.orientation=t,this.chessboard.view.redrawBoard(),this.chessboard.view.redrawPieces(a.squares),new I(this.chessboard.view,a,e,r?n:0,()=>{this.chessboard.view.redrawPieces(e.squares),o()})})}))}}const C={waitForInputStart:"waitForInputStart",pieceClickedThreshold:"pieceClickedThreshold",clickTo:"clickTo",secondClickThreshold:"secondClickThreshold",dragTo:"dragTo",clickDragTo:"clickDragTo",moveDone:"moveDone",reset:"reset"},E="secondClick",x="secondaryClick",T="movedOutOfBoard",L="draggedBack",A="clickedAnotherPiece";class O{constructor(e){this.view=e,this.chessboard=e.chessboard,this.moveInputState=null,this.fromSquare=null,this.toSquare=null,this.setMoveInputState(C.waitForInputStart)}moveInputStartedCallback(e){const t=this.view.moveInputStartedCallback(e);return t&&(this.chessboard.state.moveInputProcess=P.createTask(),this.chessboard.state.moveInputProcess.then(e=>{this.moveInputState!==C.waitForInputStart&&this.moveInputState!==C.moveDone||this.view.moveInputFinishedCallback(this.fromSquare,this.toSquare,e)})),t}movingOverSquareCallback(e,t){this.view.movingOverSquareCallback(e,t)}validateMoveInputCallback(e,t){const s=this.view.validateMoveInputCallback(e,t);return this.chessboard.state.moveInputProcess.resolve(s),s}moveInputCanceledCallback(e,t,s){this.view.moveInputCanceledCallback(e,t,s),this.chessboard.state.moveInputProcess.resolve()}setMoveInputState(e,t=void 0){const s=this.moveInputState;switch(this.moveInputState=e,e){case C.waitForInputStart:break;case C.pieceClickedThreshold:if(C.waitForInputStart!==s&&C.clickTo!==s)throw new Error("moveInputState");if(this.pointerMoveListener&&(removeEventListener(this.pointerMoveListener.type,this.pointerMoveListener),this.pointerMoveListener=null),this.pointerUpListener&&(removeEventListener(this.pointerUpListener.type,this.pointerUpListener),this.pointerUpListener=null),this.fromSquare=t.square,this.toSquare=null,this.movedPiece=t.piece,this.startPoint=t.point,this.pointerMoveListener||this.pointerUpListener)throw Error("94ad0c");if("mousedown"===t.type)this.pointerMoveListener=this.onPointerMove.bind(this),this.pointerMoveListener.type="mousemove",addEventListener("mousemove",this.pointerMoveListener),this.pointerUpListener=this.onPointerUp.bind(this),this.pointerUpListener.type="mouseup",addEventListener("mouseup",this.pointerUpListener);else{if("touchstart"!==t.type)throw Error("4b74af");this.pointerMoveListener=this.onPointerMove.bind(this),this.pointerMoveListener.type="touchmove",addEventListener("touchmove",this.pointerMoveListener),this.pointerUpListener=this.onPointerUp.bind(this),this.pointerUpListener.type="touchend",addEventListener("touchend",this.pointerUpListener)}this.contextMenuListener||(this.contextMenuListener=this.onContextMenu.bind(this),this.chessboard.view.svg.addEventListener("contextmenu",this.contextMenuListener));break;case C.clickTo:this.draggablePiece&&(a.removeElement(this.draggablePiece),this.draggablePiece=null),s===C.dragTo&&this.view.setPieceVisibility(t.square,!0);break;case C.secondClickThreshold:if(C.clickTo!==s)throw new Error("moveInputState");this.startPoint=t.point;break;case C.dragTo:if(C.pieceClickedThreshold!==s)throw new Error("moveInputState");this.view.chessboard.state.inputEnabled()&&(this.view.setPieceVisibility(t.square,!1),this.createDraggablePiece(t.piece));break;case C.clickDragTo:if(C.secondClickThreshold!==s)throw new Error("moveInputState");this.view.chessboard.state.inputEnabled()&&(this.view.setPieceVisibility(t.square,!1),this.createDraggablePiece(t.piece));break;case C.moveDone:if(-1===[C.dragTo,C.clickTo,C.clickDragTo].indexOf(s))throw new Error("moveInputState");this.toSquare=t.square,this.toSquare&&this.validateMoveInputCallback(this.fromSquare,this.toSquare)?this.chessboard.movePiece(this.fromSquare,this.toSquare,s===C.clickTo).then(()=>{s===C.clickTo&&this.view.setPieceVisibility(this.toSquare,!0),this.setMoveInputState(C.reset)}):(this.view.setPieceVisibility(this.fromSquare,!0),this.setMoveInputState(C.reset));break;case C.reset:this.fromSquare&&!this.toSquare&&this.movedPiece&&this.chessboard.state.position.setPiece(this.fromSquare,this.movedPiece),this.fromSquare=null,this.toSquare=null,this.movedPiece=null,this.draggablePiece&&(a.removeElement(this.draggablePiece),this.draggablePiece=null),this.pointerMoveListener&&(removeEventListener(this.pointerMoveListener.type,this.pointerMoveListener),this.pointerMoveListener=null),this.pointerUpListener&&(removeEventListener(this.pointerUpListener.type,this.pointerUpListener),this.pointerUpListener=null),this.contextMenuListener&&(removeEventListener("contextmenu",this.contextMenuListener),this.contextMenuListener=null),this.setMoveInputState(C.waitForInputStart);const i=this.view.piecesGroup.querySelectorAll("[visibility=hidden]");for(let e=0;e<i.length;e++)i[e].removeAttribute("visibility");break;default:throw Error(`260b09: moveInputState ${e}`)}}createDraggablePiece(e){if(this.draggablePiece)throw Error("draggablePiece already exists");this.draggablePiece=a.createSvg(document.body),this.draggablePiece.classList.add("cm-chessboard-draggable-piece"),this.draggablePiece.setAttribute("width",this.view.squareWidth),this.draggablePiece.setAttribute("height",this.view.squareHeight),this.draggablePiece.setAttribute("style","pointer-events: none"),this.draggablePiece.name=e;const t=this.chessboard.props.assetsCache?"":this.view.getSpriteUrl(),s=a.addElement(this.draggablePiece,"use",{href:`${t}#${e}`}),i=this.view.squareHeight/this.chessboard.props.style.pieces.tileSize,r=this.draggablePiece.createSVGTransform();r.setScale(i,i),s.transform.baseVal.appendItem(r)}moveDraggablePiece(e,t){this.draggablePiece.setAttribute("style",`pointer-events: none; position: absolute; left: ${e-this.view.squareHeight/2}px; top: ${t-this.view.squareHeight/2}px`)}onPointerDown(e){if(("mousedown"!==e.type||0!==e.button)&&"touchstart"!==e.type)return;const t=e.target.getAttribute("data-square");if(!t)return;const s=this.chessboard.getPiece(t);let i;if(s&&(i=s?s.substring(0,1):null,("w"===i&&this.chessboard.state.inputWhiteEnabled||"b"===i&&this.chessboard.state.inputBlackEnabled)&&e.preventDefault()),this.moveInputState!==C.waitForInputStart||this.chessboard.state.inputWhiteEnabled&&"w"===i||this.chessboard.state.inputBlackEnabled&&"b"===i){let r;if("mousedown"===e.type?r={x:e.clientX,y:e.clientY}:"touchstart"===e.type&&(r={x:e.touches[0].clientX,y:e.touches[0].clientY}),this.moveInputState===C.waitForInputStart&&s&&this.moveInputStartedCallback(t))this.setMoveInputState(C.pieceClickedThreshold,{square:t,piece:s,point:r,type:e.type});else if(this.moveInputState===C.clickTo)if(t===this.fromSquare)this.setMoveInputState(C.secondClickThreshold,{square:t,piece:s,point:r,type:e.type});else{const s=this.chessboard.getPiece(t),o=s?s.substring(0,1):null,a=this.chessboard.getPiece(this.fromSquare),n=a?a.substring(0,1):null;i&&n===o?(this.moveInputCanceledCallback(this.fromSquare,t,A),this.moveInputStartedCallback(t)?this.setMoveInputState(C.pieceClickedThreshold,{square:t,piece:s,point:r,type:e.type}):this.setMoveInputState(C.reset)):this.setMoveInputState(C.moveDone,{square:t})}}}onPointerMove(e){let t,s,i,r,o;if("mousemove"===e.type?(i=e.clientX,r=e.clientY,t=e.pageX,s=e.pageY,o=e.target):"touchmove"===e.type&&(i=e.touches[0].clientX,r=e.touches[0].clientY,t=e.touches[0].pageX,s=e.touches[0].pageY,o=document.elementFromPoint(i,r)),this.moveInputState===C.pieceClickedThreshold||this.moveInputState===C.secondClickThreshold)(Math.abs(this.startPoint.x-i)>4||Math.abs(this.startPoint.y-r)>4)&&(this.moveInputState===C.secondClickThreshold?this.setMoveInputState(C.clickDragTo,{square:this.fromSquare,piece:this.movedPiece}):this.setMoveInputState(C.dragTo,{square:this.fromSquare,piece:this.movedPiece}),this.view.chessboard.state.inputEnabled()&&this.moveDraggablePiece(t,s));else if(this.moveInputState===C.dragTo||this.moveInputState===C.clickDragTo||this.moveInputState===C.clickTo){if(o&&o.getAttribute&&o.parentElement===this.view.boardGroup){const e=o.getAttribute("data-square");e!==this.fromSquare&&e!==this.toSquare?(this.toSquare=e,this.movingOverSquareCallback(this.fromSquare,this.toSquare)):e===this.fromSquare&&null!==this.toSquare&&(this.toSquare=null,this.movingOverSquareCallback(this.fromSquare,null))}else null!==this.toSquare&&(this.toSquare=null,this.movingOverSquareCallback(this.fromSquare,null));!this.view.chessboard.state.inputEnabled()||this.moveInputState!==C.dragTo&&this.moveInputState!==C.clickDragTo||this.moveDraggablePiece(t,s)}}onPointerUp(e){let t;if("mouseup"===e.type?t=e.target:"touchend"===e.type&&(t=document.elementFromPoint(e.changedTouches[0].clientX,e.changedTouches[0].clientY)),t&&t.getAttribute){const e=t.getAttribute("data-square");if(e)this.moveInputState===C.dragTo||this.moveInputState===C.clickDragTo?this.fromSquare===e?this.moveInputState===C.clickDragTo?(this.chessboard.state.position.setPiece(this.fromSquare,this.movedPiece),this.view.setPieceVisibility(this.fromSquare),this.moveInputCanceledCallback(e,null,L),this.setMoveInputState(C.reset)):this.setMoveInputState(C.clickTo,{square:e}):this.setMoveInputState(C.moveDone,{square:e}):this.moveInputState===C.pieceClickedThreshold?this.setMoveInputState(C.clickTo,{square:e}):this.moveInputState===C.secondClickThreshold&&(this.setMoveInputState(C.reset),this.moveInputCanceledCallback(e,null,E));else{this.view.redrawPieces();const e=this.fromSquare;this.setMoveInputState(C.reset),this.moveInputCanceledCallback(e,null,T)}}else this.view.redrawPieces(),this.setMoveInputState(C.reset)}onContextMenu(e){e.preventDefault(),this.view.redrawPieces(),this.setMoveInputState(C.reset),this.moveInputCanceledCallback(this.fromSquare,null,x)}isDragging(){return this.moveInputState===C.dragTo||this.moveInputState===C.clickDragTo}destroy(){this.setMoveInputState(C.reset)}}const G="w",D="b",B="moveInputStarted",N="movingOverSquare",U="validateMoveInput",z="moveInputCanceled",F="moveInputFinished",R="pointerdown",V="none",j="thin",W="frame";class H{constructor(e){this.chessboard=e,this.visualMoveInput=new O(this),e.props.assetsCache&&this.cacheSpriteToDiv("cm-chessboard-sprite",this.getSpriteUrl()),this.container=document.createElement("div"),this.chessboard.context.appendChild(this.container),e.props.responsive&&("undefined"!=typeof ResizeObserver?(this.resizeObserver=new ResizeObserver(()=>{setTimeout(()=>{this.handleResize()})}),this.resizeObserver.observe(this.chessboard.context)):(this.resizeListener=this.handleResize.bind(this),window.addEventListener("resize",this.resizeListener))),this.positionsAnimationTask=Promise.resolve(),this.pointerDownListener=this.pointerDownHandler.bind(this),this.container.addEventListener("mousedown",this.pointerDownListener),this.container.addEventListener("touchstart",this.pointerDownListener,{passive:!1}),this.createSvgAndGroups(),this.handleResize()}pointerDownHandler(e){this.visualMoveInput.onPointerDown(e)}destroy(){this.visualMoveInput.destroy(),this.resizeObserver&&this.resizeObserver.unobserve(this.chessboard.context),this.resizeListener&&window.removeEventListener("resize",this.resizeListener),this.chessboard.context.removeEventListener("mousedown",this.pointerDownListener),this.chessboard.context.removeEventListener("touchstart",this.pointerDownListener),a.removeElement(this.svg),this.container.remove()}cacheSpriteToDiv(e,t){if(!document.getElementById(e)){const s=document.createElement("div");s.style.transform="scale(0)",s.style.position="absolute",s.setAttribute("aria-hidden","true"),s.id=e,document.body.appendChild(s);const i=new XMLHttpRequest;i.open("GET",t,!0),i.onload=function(){s.insertAdjacentHTML("afterbegin",i.response)},i.send()}}createSvgAndGroups(){this.svg=a.createSvg(this.container);let e=this.chessboard.props.style.cssClass?this.chessboard.props.style.cssClass:"default";this.svg.setAttribute("class","cm-chessboard border-type-"+this.chessboard.props.style.borderType+" "+e),this.svg.setAttribute("role","img"),this.updateMetrics(),this.boardGroup=a.addElement(this.svg,"g",{class:"board"}),this.coordinatesGroup=a.addElement(this.svg,"g",{class:"coordinates","aria-hidden":"true"}),this.markersLayer=a.addElement(this.svg,"g",{class:"markers-layer"}),this.piecesLayer=a.addElement(this.svg,"g",{class:"pieces-layer"}),this.piecesGroup=a.addElement(this.piecesLayer,"g",{class:"pieces"}),this.markersTopLayer=a.addElement(this.svg,"g",{class:"markers-top-layer"}),this.interactiveTopLayer=a.addElement(this.svg,"g",{class:"interactive-top-layer"})}updateMetrics(){const e=this.chessboard.props.style.pieces.tileSize;this.width=this.container.clientWidth,this.height=this.container.clientWidth*(this.chessboard.props.style.aspectRatio||1),this.chessboard.props.style.borderType===W?this.borderSize=this.width/25:this.chessboard.props.style.borderType===j?this.borderSize=this.width/320:this.borderSize=0,this.innerWidth=this.width-2*this.borderSize,this.innerHeight=this.height-2*this.borderSize,this.squareWidth=this.innerWidth/8,this.squareHeight=this.innerHeight/8,this.scalingX=this.squareWidth/e,this.scalingY=this.squareHeight/e,this.pieceXTranslate=this.squareWidth/2-e*this.scalingY/2}handleResize(){this.container.style.width=this.chessboard.context.clientWidth+"px",this.container.style.height=this.chessboard.context.clientWidth*this.chessboard.props.style.aspectRatio+"px",this.container.clientWidth===this.width&&this.container.clientHeight===this.height||(this.updateMetrics(),this.redrawBoard(),this.redrawPieces()),this.svg.setAttribute("width","100%"),this.svg.setAttribute("height","100%")}redrawBoard(){this.chessboard.state.invokeExtensionPoints(d),this.redrawSquares(),this.drawCoordinates(),this.chessboard.state.invokeExtensionPoints(u),this.visualizeInputState()}redrawSquares(){for(;this.boardGroup.firstChild;)this.boardGroup.removeChild(this.boardGroup.lastChild);if(a.addElement(this.boardGroup,"rect",{width:this.width,height:this.height}).setAttribute("class","border"),this.chessboard.props.style.borderType===W){const e=this.borderSize;a.addElement(this.boardGroup,"rect",{x:e,y:e,width:this.width-2*e,height:this.height-2*e}).setAttribute("class","border-inner")}for(let e=0;e<64;e++){const t=this.chessboard.state.orientation===G?e:63-e,s=`square ${9*t&8?"white":"black"}`,r=this.squareToPoint(i.indexToSquare(t)),o=a.addElement(this.boardGroup,"rect",{x:r.x,y:r.y,width:this.squareWidth,height:this.squareHeight});o.setAttribute("class",s),o.setAttribute("data-square",i.indexToSquare(t))}}drawCoordinates(){if(!this.chessboard.props.style.showCoordinates)return;for(;this.coordinatesGroup.firstChild;)this.coordinatesGroup.removeChild(this.coordinatesGroup.lastChild);const e=this.chessboard.props.style.borderType!==W;for(let t=0;t<8;t++){let s=this.borderSize+(17+this.chessboard.props.style.pieces.tileSize*t)*this.scalingX,i=this.height-3.5*this.scalingY,r="coordinate file";e&&(s+=15.5*this.scalingX,r+=t%2?" white":" black");const o=a.addElement(this.coordinatesGroup,"text",{class:r,x:s,y:i,style:`font-size: ${10*this.scalingY}px`});this.chessboard.state.orientation===G?o.textContent=String.fromCharCode(97+t):o.textContent=String.fromCharCode(104-t)}for(let t=0;t<8;t++){let s=this.borderSize/3.7,i=this.borderSize+25*this.scalingY+t*this.squareHeight,r="coordinate rank";e&&(r+=t%2?" black":" white",this.chessboard.props.style.borderType===W?(s+=10*this.scalingX,i-=15*this.scalingY):(s+=2*this.scalingX,i-=15*this.scalingY));const o=a.addElement(this.coordinatesGroup,"text",{class:r,x:s,y:i,style:`font-size: ${10*this.scalingY}px`});this.chessboard.state.orientation===G?o.textContent=""+(8-t):o.textContent=""+(1+t)}}redrawPieces(e=this.chessboard.state.position.squares){const t=Array.from(this.piecesGroup.childNodes),s=this.visualMoveInput.isDragging();for(let t=0;t<64;t++){const r=e[t];if(r){const e=i.indexToSquare(t);this.drawPieceOnSquare(e,r,s&&e===this.visualMoveInput.fromSquare)}}for(const e of t)this.piecesGroup.removeChild(e)}drawPiece(e,t,s){const i=a.addElement(e,"g",{});i.setAttribute("data-piece",t);const r=this.svg.createSVGTransform();r.setTranslate(s.x,s.y),i.transform.baseVal.appendItem(r);const o=this.chessboard.props.assetsCache?"":this.getSpriteUrl(),n=a.addElement(i,"use",{href:`${o}#${t}`,class:"piece"}),h=this.svg.createSVGTransform();return h.setScale(this.scalingY,this.scalingY),n.transform.baseVal.appendItem(h),i}drawPieceOnSquare(e,t,s=!1){const i=a.addElement(this.piecesGroup,"g",{});i.setAttribute("data-piece",t),i.setAttribute("data-square",e),s&&i.setAttribute("visibility","hidden");const r=this.squareToPoint(e),o=this.svg.createSVGTransform();o.setTranslate(r.x,r.y),i.transform.baseVal.appendItem(o);const n=this.chessboard.props.assetsCache?"":this.getSpriteUrl(),h=a.addElement(i,"use",{href:`${n}#${t}`,class:"piece"}),c=this.svg.createSVGTransform();c.setTranslate(this.pieceXTranslate,0),h.transform.baseVal.appendItem(c);const l=this.svg.createSVGTransform();return l.setScale(this.scalingY,this.scalingY),h.transform.baseVal.appendItem(l),i}setPieceVisibility(e,t=!0){const s=this.getPieceElement(e);s?t?s.setAttribute("visibility","visible"):s.setAttribute("visibility","hidden"):console.warn("no piece on",e)}getPieceElement(e){if(!e||e.length<2)return console.warn("invalid square",e),null;const t=this.piecesGroup.querySelector(`g[data-square='${e}']`);return t||(console.warn("no piece on",e),null)}enableMoveInput(e,t=null){if(this.chessboard.state.moveInputCallback)throw Error("moveInput already enabled");t===G?this.chessboard.state.inputWhiteEnabled=!0:(t===D||(this.chessboard.state.inputWhiteEnabled=!0),this.chessboard.state.inputBlackEnabled=!0),this.chessboard.state.moveInputCallback=e,this.chessboard.state.invokeExtensionPoints(c,{enabled:!0,color:t}),this.visualizeInputState()}disableMoveInput(){this.chessboard.state.inputWhiteEnabled=!1,this.chessboard.state.inputBlackEnabled=!1,this.chessboard.state.moveInputCallback=null,this.chessboard.state.invokeExtensionPoints(c,{enabled:!1}),this.visualizeInputState()}moveInputStartedCallback(e){const t={chessboard:this.chessboard,type:B,square:e,squareFrom:e,piece:this.chessboard.getPiece(e)};return this.chessboard.state.moveInputCallback&&(t.moveInputCallbackResult=this.chessboard.state.moveInputCallback(t)),this.chessboard.state.invokeExtensionPoints(l,t),t.moveInputCallbackResult}movingOverSquareCallback(e,t){const s={chessboard:this.chessboard,type:N,squareFrom:e,squareTo:t,piece:this.chessboard.getPiece(e)};this.chessboard.state.moveInputCallback&&(s.moveInputCallbackResult=this.chessboard.state.moveInputCallback(s)),this.chessboard.state.invokeExtensionPoints(l,s)}validateMoveInputCallback(e,t){const s={chessboard:this.chessboard,type:U,squareFrom:e,squareTo:t,piece:this.chessboard.getPiece(e)};return this.chessboard.state.moveInputCallback&&(s.moveInputCallbackResult=this.chessboard.state.moveInputCallback(s)),this.chessboard.state.invokeExtensionPoints(l,s),s.moveInputCallbackResult}moveInputCanceledCallback(e,t,s){const i={chessboard:this.chessboard,type:z,reason:s,squareFrom:e,squareTo:t};this.chessboard.state.moveInputCallback&&this.chessboard.state.moveInputCallback(i),this.chessboard.state.invokeExtensionPoints(l,i)}moveInputFinishedCallback(e,t,s){const i={chessboard:this.chessboard,type:F,squareFrom:e,squareTo:t,legalMove:s};this.chessboard.state.moveInputCallback&&this.chessboard.state.moveInputCallback(i),this.chessboard.state.invokeExtensionPoints(l,i)}visualizeInputState(){this.chessboard.state&&(this.chessboard.state.inputWhiteEnabled||this.chessboard.state.inputBlackEnabled?this.boardGroup.setAttribute("class","board input-enabled"):this.boardGroup.setAttribute("class","board"))}indexToPoint(e){let t,s;return this.chessboard.state.orientation===G?(t=this.borderSize+e%8*this.squareWidth,s=this.borderSize+(7-Math.floor(e/8))*this.squareHeight):(t=this.borderSize+(7-e%8)*this.squareWidth,s=this.borderSize+Math.floor(e/8)*this.squareHeight),{x:t,y:s}}squareToPoint(e){const t=i.squareToIndex(e);return this.indexToPoint(t)}getSpriteUrl(){return P.isAbsoluteUrl(this.chessboard.props.style.pieces.file)?this.chessboard.props.style.pieces.file:this.chessboard.props.assetsUrl+this.chessboard.props.style.pieces.file}}const Y="svgSprite";class X{constructor(e,t={}){if(!e)throw new Error("container element is "+e);this.context=e,this.id=(Math.random()+1).toString(36).substring(2,8),this.extensions=[],this.props={position:s,orientation:G,responsive:!0,assetsUrl:"./assets/",assetsCache:!0,style:{cssClass:"default",showCoordinates:!0,borderType:V,aspectRatio:1,pieces:{type:Y,file:"pieces/standard.svg",tileSize:40},animationDuration:300},extensions:[]},P.mergeObjects(this.props,t),this.state=new r,this.view=new H(this),this.positionAnimationsQueue=new M(this),this.state.orientation=this.props.orientation;for(const e of this.props.extensions)this.addExtension(e.class,e.props);this.view.redrawBoard(),this.state.position=new i(this.props.position),this.view.redrawPieces(),this.state.invokeExtensionPoints(n),this.initialized=Promise.resolve()}async setPiece(e,t,s=!1){const i=this.state.position.clone();return this.state.position.setPiece(e,t),this.state.invokeExtensionPoints(n),this.positionAnimationsQueue.enqueuePositionChange(i,this.state.position.clone(),s)}async movePiece(e,t,s=!1){const i=this.state.position.clone();return this.state.position.movePiece(e,t),this.state.invokeExtensionPoints(n),this.positionAnimationsQueue.enqueuePositionChange(i,this.state.position.clone(),s)}async setPosition(e,t=!1){const s=this.state.position.clone(),r=new i(e);return s.getFen()!==r.getFen()&&(this.state.position.setFen(e),this.state.invokeExtensionPoints(n)),this.positionAnimationsQueue.enqueuePositionChange(s,this.state.position.clone(),t)}async setOrientation(e,t=!1){const s=this.state.position.clone();if(!this.boardTurning)return this.boardTurning=!0,this.positionAnimationsQueue.enqueueTurnBoard(s,e,t).then(()=>{this.boardTurning=!1,this.state.invokeExtensionPoints(h)});console.warn("setOrientation is only once in queue allowed")}getPiece(e){return this.state.position.getPiece(e)}getPosition(){return this.state.position.getFen()}getOrientation(){return this.state.orientation}enableMoveInput(e,t=void 0){this.view.enableMoveInput(e,t)}disableMoveInput(){this.view.disableMoveInput()}isMoveInputEnabled(){return this.state.inputWhiteEnabled||this.state.inputBlackEnabled}enableSquareSelect(e=R,t){this.squareSelectListener||(this.squareSelectListener=function(e){const s=e.target.getAttribute("data-square");t({eventType:e.type,event:e,chessboard:this,square:s})}),this.context.addEventListener(e,this.squareSelectListener),this.state.squareSelectEnabled=!0,this.view.visualizeInputState()}disableSquareSelect(e){this.context.removeEventListener(e,this.squareSelectListener),this.squareSelectListener=void 0,this.state.squareSelectEnabled=!1,this.view.visualizeInputState()}isSquareSelectEnabled(){return this.state.squareSelectEnabled}addExtension(e,t){if(this.getExtension(e))throw Error('extension "'+e.name+'" already added');this.extensions.push(new e(this,t))}getExtension(e){for(const t of this.extensions)if(t instanceof e)return t;return null}destroy(){this.state.invokeExtensionPoints(b),this.positionAnimationsQueue.destroy(),this.view.destroy(),this.view=void 0,this.state=void 0}}const $={frame:{class:"marker-frame",slice:"markerFrame"},dot:{class:"marker-dot",slice:"markerDot",position:"above"},bevel:{class:"marker-bevel",slice:"markerBevel"}};class J extends m{constructor(e,t={}){super(e),this.registerExtensionPoint(u,()=>{this.onRedrawBoard()}),this.props={autoMarkers:$.frame,sprite:"extensions/markers/markers.svg"},Object.assign(this.props,t),e.props.assetsCache&&e.view.cacheSpriteToDiv("cm-chessboard-markers",this.getSpriteUrl()),e.addMarker=this.addMarker.bind(this),e.getMarkers=this.getMarkers.bind(this),e.removeMarkers=this.removeMarkers.bind(this),e.addLegalMovesMarkers=this.addLegalMovesMarkers.bind(this),e.removeLegalMovesMarkers=this.removeLegalMovesMarkers.bind(this),this.markerGroupDown=a.addElement(e.view.markersLayer,"g",{class:"markers"}),this.markerGroupUp=a.addElement(e.view.markersTopLayer,"g",{class:"markers"}),this.markers=[],this.props.autoMarkers&&(Object.assign(this.props.autoMarkers,this.props.autoMarkers),this.registerExtensionPoint(l,e=>{this.drawAutoMarkers(e)}))}drawAutoMarkers(e){e.type!==F&&this.removeMarkers(this.props.autoMarkers),(e.type!==B||e.moveInputCallbackResult)&&(e.type!==B&&e.type!==N||(e.squareFrom&&this.addMarker(this.props.autoMarkers,e.squareFrom),e.squareTo&&this.addMarker(this.props.autoMarkers,e.squareTo)))}onRedrawBoard(){for(;this.markerGroupUp.firstChild;)this.markerGroupUp.removeChild(this.markerGroupUp.firstChild);for(;this.markerGroupDown.firstChild;)this.markerGroupDown.removeChild(this.markerGroupDown.firstChild);this.markers.forEach(e=>{this.drawMarker(e)})}addLegalMovesMarkers(e){for(const t of e)t.promotion&&"q"!==t.promotion||(this.chessboard.getPiece(t.to)?this.chessboard.addMarker($.bevel,t.to):this.chessboard.addMarker($.dot,t.to))}removeLegalMovesMarkers(){this.chessboard.removeMarkers($.bevel),this.chessboard.removeMarkers($.dot)}drawMarker(e){let t;t="above"===e.type.position?a.addElement(this.markerGroupUp,"g"):a.addElement(this.markerGroupDown,"g"),t.setAttribute("data-square",e.square);const s=this.chessboard.view.squareToPoint(e.square),i=this.chessboard.view.svg.createSVGTransform();i.setTranslate(s.x,s.y),t.transform.baseVal.appendItem(i);const r=this.chessboard.props.assetsCache?"":this.getSpriteUrl(),o=a.addElement(t,"use",{href:`${r}#${e.type.slice}`,class:"marker "+e.type.class}),n=this.chessboard.view.svg.createSVGTransform();return n.setScale(this.chessboard.view.scalingX,this.chessboard.view.scalingY),o.transform.baseVal.appendItem(n),t}addMarker(e,t){"string"!=typeof e&&"object"!=typeof t?(this.markers.push(new Q(t,e)),this.onRedrawBoard()):console.error("changed the signature of `addMarker` to `(type, square)` with v5.1.x")}getMarkers(e=void 0,t=void 0){if("string"==typeof e||"object"==typeof t)return void console.error("changed the signature of `getMarkers` to `(type, square)` with v5.1.x");let s=[];return this.markers.forEach(i=>{i.matches(t,e)&&s.push(i)}),s}removeMarkers(e=void 0,t=void 0){"string"!=typeof e&&"object"!=typeof t?(this.markers=this.markers.filter(s=>!s.matches(t,e)),this.onRedrawBoard()):console.error("changed the signature of `removeMarkers` to `(type, square)` with v5.1.x")}getSpriteUrl(){return P.isAbsoluteUrl(this.props.sprite)?this.props.sprite:this.chessboard.props.assetsUrl+this.props.sprite}}class Q{constructor(e,t){this.square=e,this.type=t}matches(e=void 0,t=void 0){if(!t&&!e)return!0;if(t){if(e){if(this.type===t&&e===this.square)return!0}else if(this.type===t)return!0}else if(e===this.square)return!0;return!1}}class _{constructor(s,i){this.chessboard=i.chessboard,this.chessboard.setPosition(s,!0),window.cmAudioContext||e(),this.moveSound=new t("../node_modules/cm-web-modules/assets/move.mp3"),this.chessboard.context.addEventListener("pointerdown",e=>{const t=e.target.getAttribute("data-square");if(t){const e=this.chessboard.getPiece(t),s=this.chessboard.state.position.getPieces(D)[0].square;if(e&&"w"===e.charAt(0)&&this.isValidMove(s,t)){this.chessboard.movePiece(s,t,!0),this.chessboard.context.style.cursor="";const e=this.chessboard.state.position.getPieces(G).length;this.moveSound.play(),0===e&&i.levelFinished()}}}),this.chessboard.context.addEventListener("mouseover",e=>{const t=e.target.getAttribute("data-square");if(this.chessboard.removeMarkers(),t){const s=this.chessboard.getPiece(t);s?(e.target.style.cursor="pointer","w"===s.charAt(0)&&this.chessboard.addMarker($.frame,t)):e.target.style.cursor=""}})}isValidMove(e,t){switch(this.chessboard.getPiece(e).charAt(1)){case"r":return this.validateRookMove(e,t);case"b":return this.validateBishopMove(e,t);case"q":return this.validateQueenMove(e,t);case"n":return this.validateKnightMove(e,t)}}validateRookMove(e,t){const s=e.charCodeAt(0)-97,i=parseInt(e.charAt(1))-1,r=t.charCodeAt(0)-97,o=parseInt(t.charAt(1))-1;if(s===r)for(let e=Math.min(i,o)+1;e<Math.max(i,o);e++){const t=String.fromCharCode(s+97)+(e+1);if(this.chessboard.getPiece(t))return!1}if(i===o)for(let e=Math.min(s,r)+1;e<Math.max(s,r);e++){const t=String.fromCharCode(e+97)+(i+1);if(this.chessboard.getPiece(t))return!1}if(s===r||i===o)return!0}validateBishopMove(e,t){const s=e.charCodeAt(0)-97,i=parseInt(e.charAt(1))-1,r=t.charCodeAt(0)-97-s,o=parseInt(t.charAt(1))-1-i;if(Math.abs(r)!==Math.abs(o)||0===r)return!1;const a=r>0?1:-1,n=o>0?1:-1;for(let e=1;e<Math.abs(r);e++){const t=s+e*a,r=i+e*n,o=String.fromCharCode(t+97)+(r+1);if(this.chessboard.getPiece(o))return!1}return!0}validateQueenMove(e,t){return console.log("validateRookMove",this.validateRookMove(e,t)),console.log("validateBishopMove",this.validateBishopMove(e,t)),this.validateRookMove(e,t)||this.validateBishopMove(e,t)}validateKnightMove(e,t){const s=e.charCodeAt(0)-97,i=parseInt(e.charAt(1))-1,r=t.charCodeAt(0)-97,o=parseInt(t.charAt(1))-1;return 1===Math.abs(s-r)&&2===Math.abs(i-o)||(2===Math.abs(s-r)&&1===Math.abs(i-o)||void 0)}}class K{constructor(){this.levelGroupName||(this.levelGroupName="Rook",this.marathonMode=!1,this.level=0,this.MenuCheckpoint="game.html",localStorage.getItem("beatenLevels")||(this.beatenLevels={Rook:0,Bishop:0,Knight:0,Queen:0}))}set levelGroupName(e){localStorage.setItem("levelGroupName",JSON.stringify(e))}get levelGroupName(){return JSON.parse(localStorage.getItem("levelGroupName"))}set level(e){localStorage.setItem("level",JSON.stringify(e))}get level(){return JSON.parse(localStorage.getItem("level"))}set marathonMode(e){localStorage.setItem("marathonMode",JSON.stringify(e))}get marathonMode(){return JSON.parse(localStorage.getItem("marathonMode"))}set MenuCheckpoint(e){localStorage.setItem("MenuCheckpoint",JSON.stringify(e))}get MenuCheckpoint(){return JSON.parse(localStorage.getItem("MenuCheckpoint"))}set beatenLevels(e){localStorage.setItem("beatenLevels",JSON.stringify(e))}get beatenLevels(){return JSON.parse(localStorage.getItem("beatenLevels"))||{Rook:0,Bishop:0,Knight:0,Queen:0}}}class Z{static shoot(){var e={origin:{y:.9}};function t(t,s){confetti({...e,...s,particleCount:Math.floor(200*t)})}t(.25,{spread:26,startVelocity:55}),t(.2,{spread:60}),t(.35,{spread:100,decay:.91,scalar:.8}),t(.1,{spread:120,startVelocity:25,decay:.92,scalar:1.2}),t(.1,{spread:120,startVelocity:45})}}const ee={Rook:["8/8/8/8/2P1rP2/8/8/8 b - - 0 1","8/1P6/8/1P1r4/8/1P2P3/8/8 b - - 0 1","7P/8/8/4r3/8/8/1P2P2P/8 b - - 0 1","8/8/4P3/8/8/4P2P/1r2P3/P3P2P b - - 0 1","4P3/8/8/1P2r2P/8/8/1P2P3/8 b - - 0 1","8/1P5P/8/P3P3/8/1P1P1P2/P6P/1P1r4 b - - 0 1","8/2P1PP2/8/P1P1P3/8/2P3PP/6r1/6P1 b - - 0 1","8/8/PP3P2/8/Pr3P2/3P4/P4P2/1P1P4 b - - 0 1","2P4P/P3P3/8/2P4P/8/P1P2P1P/5r2/P4P2 b - - 0 1","P7/4P2P/2P3P1/8/P1Pr4/8/1P1P2P1/P6P b - - 0 1"],Bishop:["8/8/4P3/1P1b4/2P5/3P4/8/8 b - - 0 1","8/8/P3b3/8/8/7P/8/5P2 b - - 0 1","4P1P1/8/P1P1P3/8/P3b3/7P/P3P3/3P1P2 b - - 0 1","3P1P2/2P5/1P5P/P5P1/3b4/4P1P1/8/4P3 b - - 0 1","8/4P1P1/3P1P1P/8/3P1b1P/8/3P1P1P/8 b - - 0 1","3P1P2/P1P3P1/7P/P7/5P1P/8/1b3P1P/P7 b - - 0 1","3P1P2/P1P3P1/7P/P7/5P1P/8/1b3P1P/P7 b - - 0 1","8/P3P1P1/8/2P1b1P1/7P/P3P3/1P3P2/2P3P1 b - - 0 1","6P1/1P5P/P7/3P4/4b3/3P3P/P5P1/1P3P2 b - - 0 1","3P4/6P1/3P3P/8/1P1P1b1P/8/3P1P2/8 b - - 0 1"],Knight:["n5P1/4P3/1P5P/3P4/6P1/8/5P2/7P b - - 0 1","8/8/4PP2/3P3P/3n1P2/4P1P1/8/5P2 b - - 0 1","8/8/2P5/4P3/1P1n1P2/3P1P2/2P3P1/4P3 b - - 0 1","8/3P4/5P2/2P1P3/4P1P1/3P2n1/5P2/7P b - - 0 1","8/8/8/8/3nPPP1/3P2P1/3PPP1P/5P2 b - - 0 1","8/6P1/4P3/3P2PP/5P2/2P3PP/4P3/6n1 b - - 0 1","7P/5P2/6P1/4nP2/3P3P/1P3P2/3P4/8 b - - 0 1","8/4P3/8/3P1P1P/5PP1/4P1PP/7P/5Pn1 b - - 0 1","4P3/8/3P1P2/8/2P1n1P1/3P4/3P1P2/4P3 b - - 0 1","1P4P1/3PPP2/1P1P3P/3PnP2/1P2P3/3P1P2/3P4/4P3 b - - 0 1"],Queen:["8/8/5P2/3q2P1/8/P3P2P/6P1/P7 b - - 0 1","4P3/8/2q1P1P1/8/8/3P3P/8/8 b - - 0 1","2P5/P7/8/2P4P/P3q3/7P/4P3/5P2 b - - 0 1","P6P/8/2q1P2P/8/2P5/8/8/P1P4P b - - 0 1","1P4P1/8/4P3/8/P1q3P1/8/4P3/1P4P1 b - - 0 1","2P5/3P1P2/8/6P1/4q3/8/4P1P1/2P3P1 b - - 0 1","3P4/8/1P5P/3q4/8/4P3/8/2P4P b - - 0 1","1P6/4P3/5P2/1P6/4q3/2P3P1/8/8 b - - 0 1 ","6P1/8/1P6/P5P1/3q4/1P4P1/3P1P2/8 b - - 0 1","4P3/1q6/2P3P2/P6P/8/5P1P/7P/1P2P3 b - - 0 1"]};class te{constructor(){window.cmAudioContext||e(),this.buttons=document.getElementById("buttons"),this.restartButton=document.getElementById("restartButton"),this.menuButton=document.getElementById("menuButton"),this.closebtn=document.getElementById("closebtn"),this.restartButton.addEventListener("click",this.restartLevel.bind(this)),this.menuButton.addEventListener("click",this.openNav.bind(this)),this.closebtn.addEventListener("click",this.closeNav.bind(this)),this.winSound=new t("./assets/winSound.mp3"),this.chessboard=new X(document.querySelector(".board"),{assetsUrl:"./node_modules/cm-chessboard/assets/",style:{showCoordinates:!0,pieces:{file:"pieces/staunty.svg"}},extensions:[{class:J}]}),this.state=new K,this.restartLevel()}reloadUI(){const e=document.getElementById("levelGroup"),t=document.getElementById("level");e.innerText=this.state.levelGroupName,t.innerText=this.state.level+1}levelFinished(){console.log("levelFinished, TODO win animation");const e=this.state.beatenLevels;e[this.state.levelGroupName]=Math.max(e[this.state.levelGroupName]||0,this.state.level+1),this.state.beatenLevels=e,setTimeout(()=>{this.nextLevel()},500)}nextLevel(){if(this.state.level++,!ee[this.state.levelGroupName][this.state.level]){const e=Object.keys(ee).length,t=Object.keys(ee),s=t.indexOf(this.state.levelGroupName);s<e-1&0==this.state.marathonMode?(Z.shoot(),this.winSound.play(),this.state.levelGroupName=t[s+1],this.state.level=0):(console.log("game finished"),this.buttons.style.display="none",Z.shoot(),this.winSound.play(),setTimeout(()=>{window.location.href="index.html",this.state.marathonMode=!1},2e3))}this.reloadUI(),this.state.currentLevel=new _(ee[this.state.levelGroupName][this.state.level],this)}restartLevel(){console.log("restartLevel",this.state.levelGroupName,this.state.level),this.state.currentLevel=new _(ee[this.state.levelGroupName][this.state.level],this),this.currentCheckpoint(),this.reloadUI()}openNav(){document.getElementById("myNav").style.display="block"}closeNav(){document.getElementById("myNav").style.display="none"}goBack(){const e=JSON.parse(localStorage.getItem("MenuCheckpoint"));window.location=e||"index.html"}currentCheckpoint(){localStorage.setItem("MenuCheckpoint",JSON.stringify("game.html"))}}export{te as Game,ee as LEVELS};
//# sourceMappingURL=nodeBundle.js.map
