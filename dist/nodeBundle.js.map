{"version":3,"file":"nodeBundle.js","sources":["../node_modules/cm-chessboard/src/model/Position.js","../node_modules/cm-chessboard/src/model/ChessboardState.js","../node_modules/cm-chessboard/src/lib/Svg.js","../node_modules/cm-chessboard/src/model/Extension.js","../node_modules/cm-chessboard/src/lib/Utils.js","../node_modules/cm-chessboard/src/view/PositionAnimationsQueue.js","../node_modules/cm-chessboard/src/view/VisualMoveInput.js","../node_modules/cm-chessboard/src/view/ChessboardView.js","../node_modules/cm-chessboard/src/Chessboard.js","../node_modules/cm-chessboard/src/extensions/markers/Markers.js","../node_modules/cm-web-modules/src/audio/Audio.js","../node_modules/cm-web-modules/src/audio/Sample.js","../src/Level.js","../src/GameState.js","../src/Confetti.js","../src/Game.js"],"sourcesContent":["/**\n * Author and copyright: Stefan Haack (https://shaack.com)\n * Repository: https://github.com/shaack/cm-chessboard\n * License: MIT, see file 'LICENSE'\n */\nexport const FEN = {\n    start: \"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1\",\n    empty: \"8/8/8/8/8/8/8/8\"\n}\n\nexport class Position {\n\n    constructor(fen = FEN.empty) {\n        this.squares = new Array(64).fill(null)\n        this.setFen(fen)\n    }\n\n    setFen(fen = FEN.empty) {\n        const parts = fen.replace(/^\\s*/, \"\").replace(/\\s*$/, \"\").split(/\\/|\\s/)\n        for (let part = 0; part < 8; part++) {\n            const row = parts[7 - part].replace(/\\d/g, (str) => {\n                const numSpaces = parseInt(str)\n                let ret = ''\n                for (let i = 0; i < numSpaces; i++) {\n                    ret += '-'\n                }\n                return ret\n            })\n            for (let c = 0; c < 8; c++) {\n                const char = row.substring(c, c + 1)\n                let piece = null\n                if (char !== '-') {\n                    if (char.toUpperCase() === char) {\n                        piece = `w${char.toLowerCase()}`\n                    } else {\n                        piece = `b${char}`\n                    }\n                }\n                this.squares[part * 8 + c] = piece\n            }\n        }\n    }\n\n    getFen() {\n        let parts = new Array(8).fill(\"\")\n        for (let part = 0; part < 8; part++) {\n            let spaceCounter = 0\n            for (let i = 0; i < 8; i++) {\n                const piece = this.squares[part * 8 + i]\n                if (!piece) {\n                    spaceCounter++\n                } else {\n                    if (spaceCounter > 0) {\n                        parts[7 - part] += spaceCounter\n                        spaceCounter = 0\n                    }\n                    const color = piece.substring(0, 1)\n                    const name = piece.substring(1, 2)\n                    if (color === \"w\") {\n                        parts[7 - part] += name.toUpperCase()\n                    } else {\n                        parts[7 - part] += name\n                    }\n                }\n            }\n            if (spaceCounter > 0) {\n                parts[7 - part] += spaceCounter\n                spaceCounter = 0\n            }\n        }\n        return parts.join(\"/\")\n    }\n\n    getPieces(pieceColor = undefined, pieceType = undefined, sortBy = ['k', 'q', 'r', 'b', 'n', 'p']) {\n        const pieces = []\n        const sort = (a, b) => {\n            return sortBy.indexOf(a.name) - sortBy.indexOf(b.name)\n        }\n        for (let i = 0; i < 64; i++) {\n            const piece = this.squares[i]\n            if (piece) {\n                const type = piece.charAt(1)\n                const color = piece.charAt(0)\n                const square = Position.indexToSquare(i)\n                if(pieceType && pieceType !== type || pieceColor && pieceColor !== color) {\n                    continue\n                }\n                pieces.push({\n                    name: type, // deprecated, use type\n                    type: type,\n                    color: color,\n                    position: square, // deprecated, use square\n                    square: square\n                })\n            }\n        }\n        if (sortBy) {\n            pieces.sort(sort)\n        }\n        return pieces\n    }\n\n    movePiece(squareFrom, squareTo) {\n        if (!this.squares[Position.squareToIndex(squareFrom)]) {\n            console.warn(\"no piece on\", squareFrom)\n            return\n        }\n        this.squares[Position.squareToIndex(squareTo)] = this.squares[Position.squareToIndex(squareFrom)]\n        this.squares[Position.squareToIndex(squareFrom)] = null\n    }\n\n    setPiece(square, piece) {\n        this.squares[Position.squareToIndex(square)] = piece\n    }\n\n    getPiece(square) {\n        return this.squares[Position.squareToIndex(square)]\n    }\n\n    static squareToIndex(square) {\n        const coordinates = Position.squareToCoordinates(square)\n        return coordinates[0] + coordinates[1] * 8\n    }\n\n    static indexToSquare(index) {\n        return this.coordinatesToSquare([Math.floor(index % 8), index / 8])\n    }\n\n    static squareToCoordinates(square) {\n        const file = square.charCodeAt(0) - 97\n        const rank = square.charCodeAt(1) - 49\n        return [file, rank]\n    }\n\n    static coordinatesToSquare(coordinates) {\n        const file = String.fromCharCode(coordinates[0] + 97)\n        const rank = String.fromCharCode(coordinates[1] + 49)\n        return file + rank\n    }\n\n    toString() {\n        return this.getFen()\n    }\n\n    clone() {\n        const cloned = new Position()\n        cloned.squares = this.squares.slice(0)\n        return cloned\n    }\n\n}\n","/**\n * Author and copyright: Stefan Haack (https://shaack.com)\n * Repository: https://github.com/shaack/cm-chessboard\n * License: MIT, see file 'LICENSE'\n */\nimport {Position} from \"./Position.js\"\n\nexport class ChessboardState {\n\n    constructor() {\n        this.position = new Position()\n        this.orientation = undefined\n        this.inputWhiteEnabled = false\n        this.inputBlackEnabled = false\n        this.squareSelectEnabled = false\n        this.moveInputCallback = null\n        this.extensionPoints = {}\n        this.moveInputProcess = Promise.resolve()\n    }\n\n    inputEnabled() {\n        return this.inputWhiteEnabled || this.inputBlackEnabled\n    }\n\n    invokeExtensionPoints(name, data = {}) {\n        const extensionPoints = this.extensionPoints[name]\n        const dataCloned = Object.assign({}, data)\n        dataCloned.extensionPoint = name\n        let returnValue = true\n        if (extensionPoints) {\n            for (const extensionPoint of extensionPoints) {\n                if(extensionPoint(dataCloned) === false) {\n                    returnValue = false\n                }\n            }\n        }\n        return returnValue\n    }\n\n}\n","/**\n * Author and copyright: Stefan Haack (https://shaack.com)\n * Repository: https://github.com/shaack/cm-chessboard\n * License: MIT, see file 'LICENSE'\n */\n\nconst SVG_NAMESPACE = \"http://www.w3.org/2000/svg\"\n\nexport class Svg {\n\n    /**\n     * create the Svg in the HTML DOM\n     * @param containerElement\n     * @returns {Element}\n     */\n    static createSvg(containerElement = undefined) {\n        let svg = document.createElementNS(SVG_NAMESPACE, \"svg\")\n        if (containerElement) {\n            svg.setAttribute(\"width\", \"100%\")\n            svg.setAttribute(\"height\", \"100%\")\n            containerElement.appendChild(svg)\n        }\n        return svg\n    }\n\n    /**\n     * Add an Element to an SVG DOM\n     * @param parent\n     * @param name\n     * @param attributes\n     * @returns {Element}\n     */\n    static addElement(parent, name, attributes = {}) {\n        let element = document.createElementNS(SVG_NAMESPACE, name)\n        if (name === \"use\") {\n            attributes[\"xlink:href\"] = attributes[\"href\"] // fix for safari\n        }\n        for (let attribute in attributes) {\n            if (attributes.hasOwnProperty(attribute)) {\n                if (attribute.indexOf(\":\") !== -1) {\n                    const value = attribute.split(\":\")\n                    element.setAttributeNS(\"http://www.w3.org/1999/\" + value[0], value[1], attributes[attribute])\n                } else {\n                    element.setAttribute(attribute, attributes[attribute])\n                }\n            }\n        }\n        parent.appendChild(element)\n        return element\n    }\n\n    /**\n     * Remove an element from an SVG DOM\n     * @param element\n     */\n    static removeElement(element) {\n        if(!element) {\n            console.warn(\"removeElement, element is\", element)\n            return\n        }\n        if (element.parentNode) {\n            element.parentNode.removeChild(element)\n        } else {\n            console.warn(element, \"without parentNode\")\n        }\n    }\n\n}\n","/**\n * Author and copyright: Stefan Haack (https://shaack.com)\n * Repository: https://github.com/shaack/cm-chessboard\n * License: MIT, see file 'LICENSE'\n */\n\nexport const EXTENSION_POINT = {\n    positionChanged: \"positionChanged\", // the positions of the pieces was changed\n    boardChanged: \"boardChanged\", // the board (orientation) was changed\n    moveInputToggled: \"moveInputToggled\", // move input was enabled or disabled\n    moveInput: \"moveInput\", // move started, moving over a square, validating or canceled\n    beforeRedrawBoard: \"beforeRedrawBoard\", // called before redrawing the board\n    afterRedrawBoard: \"afterRedrawBoard\", // called after redrawing the board\n    redrawBoard: \"redrawBoard\", // called after redrawing the board, DEPRECATED, use afterRedrawBoard 2023-09-18\n    animation: \"animation\", // called on animation start, end, and on every animation frame\n    destroy: \"destroy\" // called, before the board is destroyed\n}\n\nexport class Extension {\n\n    constructor(chessboard) {\n        this.chessboard = chessboard\n    }\n\n    registerExtensionPoint(name, callback) {\n        if(name === EXTENSION_POINT.redrawBoard) { // deprecated 2023-09-18\n            console.warn(\"EXTENSION_POINT.redrawBoard is deprecated, use EXTENSION_POINT.afterRedrawBoard\")\n            name = EXTENSION_POINT.afterRedrawBoard\n        }\n        if (!this.chessboard.state.extensionPoints[name]) {\n            this.chessboard.state.extensionPoints[name] = []\n        }\n        this.chessboard.state.extensionPoints[name].push(callback)\n    }\n\n    /** @deprecated 2023-05-18 */\n    registerMethod(name, callback) {\n        console.warn(\"registerMethod is deprecated, just add methods directly to the chessboard instance\")\n        if (!this.chessboard[name]) {\n            this.chessboard[name] = (...args) => {\n                return callback.apply(this, args)\n            }\n        } else {\n            log.error(\"method\", name, \"already exists\")\n        }\n    }\n\n}\n","/**\n * Author and copyright: Stefan Haack (https://shaack.com)\n * Repository: https://github.com/shaack/cm-chessboard\n * License: MIT, see file 'LICENSE'\n */\n\nexport class Utils {\n\n    static delegate(element, eventName, selector, handler) {\n        const eventListener = function (event) {\n            let target = event.target\n            while (target && target !== this) {\n                if (target.matches(selector)) {\n                    handler.call(target, event)\n                }\n                target = target.parentNode\n            }\n        }\n        element.addEventListener(eventName, eventListener)\n        return {\n            remove: function () {\n                element.removeEventListener(eventName, eventListener)\n            }\n        }\n    }\n\n    static mergeObjects(target, source) {\n        const isObject = (obj) => obj && typeof obj === 'object'\n        if (!isObject(target) || !isObject(source)) {\n            return source\n        }\n        for (const key of Object.keys(source)) {\n            if (source[key] instanceof Object) {\n                Object.assign(source[key], Utils.mergeObjects(target[key], source[key]))\n            }\n        }\n        Object.assign(target || {}, source)\n        return target\n    }\n\n    static createDomElement(html) {\n        const template = document.createElement('template')\n        template.innerHTML = html.trim()\n        return template.content.firstChild\n    }\n\n    static createTask() {\n        let resolve, reject\n        const promise = new Promise(function (_resolve, _reject) {\n            resolve = _resolve\n            reject = _reject\n        })\n        promise.resolve = resolve\n        promise.reject = reject\n        return promise\n    }\n\n    static isAbsoluteUrl(url) {\n        return url.indexOf(\"://\") !== -1 || url.startsWith(\"/\")\n    }\n\n}\n","/**\n * Author and copyright: Stefan Haack (https://shaack.com)\n * Repository: https://github.com/shaack/cm-chessboard\n * License: MIT, see file 'LICENSE'\n */\nimport {FEN, Position} from \"../model/Position.js\"\nimport {Svg} from \"../lib/Svg.js\"\nimport {EXTENSION_POINT} from \"../model/Extension.js\"\nimport {Utils} from \"../lib/Utils.js\"\n\n/*\n* Thanks to markosyan for the idea of the PromiseQueue\n* https://medium.com/@karenmarkosyan/how-to-manage-promises-into-dynamic-queue-with-vanilla-javascript-9d0d1f8d4df5\n*/\n\nexport const ANIMATION_EVENT_TYPE = {\n    start: \"start\",\n    frame: \"frame\",\n    end: \"end\"\n}\n\nexport class PromiseQueue {\n\n    constructor() {\n        this.queue = []\n        this.workingOnPromise = false\n        this.stop = false\n    }\n\n    async enqueue(promise) {\n        return new Promise((resolve, reject) => {\n            this.queue.push({\n                promise, resolve, reject,\n            })\n            this.dequeue()\n        })\n    }\n\n    dequeue() {\n        if (this.workingOnPromise) {\n            return\n        }\n        if (this.stop) {\n            this.queue = []\n            this.stop = false\n            return\n        }\n        const entry = this.queue.shift()\n        if (!entry) {\n            return\n        }\n        try {\n            this.workingOnPromise = true\n            entry.promise().then((value) => {\n                this.workingOnPromise = false\n                entry.resolve(value)\n                this.dequeue()\n            }).catch(err => {\n                this.workingOnPromise = false\n                entry.reject(err)\n                this.dequeue()\n            })\n        } catch (err) {\n            this.workingOnPromise = false\n            entry.reject(err)\n            this.dequeue()\n        }\n        return true\n    }\n\n    destroy() {\n        this.stop = true\n    }\n\n}\n\n\nconst CHANGE_TYPE = {\n    move: 0,\n    appear: 1,\n    disappear: 2\n}\n\nexport class PositionsAnimation {\n\n    constructor(view, fromPosition, toPosition, duration, callback) {\n        this.view = view\n        if (fromPosition && toPosition) {\n            this.animatedElements = this.createAnimation(fromPosition.squares, toPosition.squares)\n            this.duration = duration\n            this.callback = callback\n            this.frameHandle = requestAnimationFrame(this.animationStep.bind(this))\n        } else {\n            console.error(\"fromPosition\", fromPosition, \"toPosition\", toPosition)\n        }\n        this.view.positionsAnimationTask = Utils.createTask()\n        this.view.chessboard.state.invokeExtensionPoints(EXTENSION_POINT.animation, {\n            type: ANIMATION_EVENT_TYPE.start\n        })\n    }\n\n    static seekChanges(fromSquares, toSquares) {\n        const appearedList = [], disappearedList = [], changes = []\n        for (let i = 0; i < 64; i++) {\n            const previousSquare = fromSquares[i]\n            const newSquare = toSquares[i]\n            if (newSquare !== previousSquare) {\n                if (newSquare) {\n                    appearedList.push({piece: newSquare, index: i})\n                }\n                if (previousSquare) {\n                    disappearedList.push({piece: previousSquare, index: i})\n                }\n            }\n        }\n        appearedList.forEach((appeared) => {\n            let shortestDistance = 8\n            let foundMoved = null\n            disappearedList.forEach((disappeared) => {\n                if (appeared.piece === disappeared.piece) {\n                    const moveDistance = PositionsAnimation.squareDistance(appeared.index, disappeared.index)\n                    if (moveDistance < shortestDistance) {\n                        foundMoved = disappeared\n                        shortestDistance = moveDistance\n                    }\n                }\n            })\n            if (foundMoved) {\n                disappearedList.splice(disappearedList.indexOf(foundMoved), 1) // remove from disappearedList, because it is moved now\n                changes.push({\n                    type: CHANGE_TYPE.move,\n                    piece: appeared.piece,\n                    atIndex: foundMoved.index,\n                    toIndex: appeared.index\n                })\n            } else {\n                changes.push({type: CHANGE_TYPE.appear, piece: appeared.piece, atIndex: appeared.index})\n            }\n        })\n        disappearedList.forEach((disappeared) => {\n            changes.push({type: CHANGE_TYPE.disappear, piece: disappeared.piece, atIndex: disappeared.index})\n        })\n        return changes\n    }\n\n    createAnimation(fromSquares, toSquares) {\n        const changes = PositionsAnimation.seekChanges(fromSquares, toSquares)\n        const animatedElements = []\n        changes.forEach((change) => {\n            const animatedItem = {\n                type: change.type\n            }\n            switch (change.type) {\n                case CHANGE_TYPE.move:\n                    animatedItem.element = this.view.getPieceElement(Position.indexToSquare(change.atIndex))\n                    animatedItem.element.parentNode.appendChild(animatedItem.element) // move element to top layer\n                    animatedItem.atPoint = this.view.indexToPoint(change.atIndex)\n                    animatedItem.toPoint = this.view.indexToPoint(change.toIndex)\n                    break\n                case CHANGE_TYPE.appear:\n                    animatedItem.element = this.view.drawPieceOnSquare(Position.indexToSquare(change.atIndex), change.piece)\n                    animatedItem.element.style.opacity = 0\n                    break\n                case CHANGE_TYPE.disappear:\n                    animatedItem.element = this.view.getPieceElement(Position.indexToSquare(change.atIndex))\n                    break\n            }\n            animatedElements.push(animatedItem)\n        })\n        return animatedElements\n    }\n\n    animationStep(time) {\n        if(!this.view || !this.view.chessboard.state) { // board was destroyed\n            return\n        }\n        if (!this.startTime) {\n            this.startTime = time\n        }\n        const timeDiff = time - this.startTime\n        if (timeDiff <= this.duration) {\n            this.frameHandle = requestAnimationFrame(this.animationStep.bind(this))\n        } else {\n            cancelAnimationFrame(this.frameHandle)\n            this.animatedElements.forEach((animatedItem) => {\n                if (animatedItem.type === CHANGE_TYPE.disappear) {\n                    Svg.removeElement(animatedItem.element)\n                }\n            })\n            this.view.positionsAnimationTask.resolve()\n            this.view.chessboard.state.invokeExtensionPoints(EXTENSION_POINT.animation, {\n                type: ANIMATION_EVENT_TYPE.end\n            })\n            this.callback()\n            return\n        }\n        const t = Math.min(1, timeDiff / this.duration)\n        let progress = t < .5 ? 2 * t * t : -1 + (4 - 2 * t) * t // easeInOut\n        if (isNaN(progress) || progress > 0.99) {\n            progress = 1\n        }\n        this.animatedElements.forEach((animatedItem) => {\n            if (animatedItem.element) {\n                switch (animatedItem.type) {\n                    case CHANGE_TYPE.move:\n                        animatedItem.element.transform.baseVal.removeItem(0)\n                        const transform = (this.view.svg.createSVGTransform())\n                        transform.setTranslate(\n                            animatedItem.atPoint.x + (animatedItem.toPoint.x - animatedItem.atPoint.x) * progress,\n                            animatedItem.atPoint.y + (animatedItem.toPoint.y - animatedItem.atPoint.y) * progress)\n                        animatedItem.element.transform.baseVal.appendItem(transform)\n                        break\n                    case CHANGE_TYPE.appear:\n                        animatedItem.element.style.opacity = Math.round(progress * 100) / 100\n                        break\n                    case CHANGE_TYPE.disappear:\n                        animatedItem.element.style.opacity = Math.round((1 - progress) * 100) / 100\n                        break\n                }\n            } else {\n                console.warn(\"animatedItem has no element\", animatedItem)\n            }\n        })\n        this.view.chessboard.state.invokeExtensionPoints(EXTENSION_POINT.animation, {\n            type: ANIMATION_EVENT_TYPE.frame,\n            progress: progress\n        })\n    }\n\n    static squareDistance(index1, index2) {\n        const file1 = index1 % 8\n        const rank1 = Math.floor(index1 / 8)\n        const file2 = index2 % 8\n        const rank2 = Math.floor(index2 / 8)\n        return Math.max(Math.abs(rank2 - rank1), Math.abs(file2 - file1))\n    }\n\n}\n\nexport class PositionAnimationsQueue extends PromiseQueue {\n\n    constructor(chessboard) {\n        super()\n        this.chessboard = chessboard\n    }\n\n    async enqueuePositionChange(positionFrom, positionTo, animated) {\n        if(positionFrom.getFen() === positionTo.getFen()) {\n            return Promise.resolve()\n        } else {\n            return super.enqueue(() => new Promise((resolve) => {\n                let duration = animated ? this.chessboard.props.style.animationDuration : 0\n                if (this.queue.length > 0) {\n                    duration = duration / (1 + Math.pow(this.queue.length / 5, 2))\n                }\n                new PositionsAnimation(this.chessboard.view,\n                    positionFrom, positionTo, animated ? duration : 0,\n                    () => {\n                        if (this.chessboard.view) { // if destroyed, no view anymore\n                            this.chessboard.view.redrawPieces(positionTo.squares)\n                        }\n                        resolve()\n                    }\n                )\n            }))\n        }\n    }\n\n    async enqueueTurnBoard(position, color, animated) {\n        return super.enqueue(() => new Promise((resolve) => {\n            const emptyPosition = new Position(FEN.empty)\n            let duration = animated ? this.chessboard.props.style.animationDuration : 0\n            if(this.queue.length > 0) {\n                duration = duration / (1 + Math.pow(this.queue.length / 5, 2))\n            }\n            new PositionsAnimation(this.chessboard.view,\n                position, emptyPosition, animated ? duration : 0,\n                () => {\n                    this.chessboard.state.orientation = color\n                    this.chessboard.view.redrawBoard()\n                    this.chessboard.view.redrawPieces(emptyPosition.squares)\n                    new PositionsAnimation(this.chessboard.view,\n                        emptyPosition, position, animated ? duration : 0,\n                        () => {\n                            this.chessboard.view.redrawPieces(position.squares)\n                            resolve()\n                        }\n                    )\n                }\n            )\n        }))\n    }\n\n}\n","/**\n * Author and copyright: Stefan Haack (https://shaack.com)\n * Repository: https://github.com/shaack/cm-chessboard\n * License: MIT, see file 'LICENSE'\n */\n\nimport {Svg} from \"../lib/Svg.js\"\nimport {Utils} from \"../lib/Utils.js\"\n\nconst MOVE_INPUT_STATE = {\n    waitForInputStart: \"waitForInputStart\",\n    pieceClickedThreshold: \"pieceClickedThreshold\",\n    clickTo: \"clickTo\",\n    secondClickThreshold: \"secondClickThreshold\",\n    dragTo: \"dragTo\",\n    clickDragTo: \"clickDragTo\",\n    moveDone: \"moveDone\",\n    reset: \"reset\"\n}\n\nexport const MOVE_CANCELED_REASON = {\n    secondClick: \"secondClick\", // clicked the same piece\n    secondaryClick: \"secondaryClick\", // right click while moving\n    movedOutOfBoard: \"movedOutOfBoard\",\n    draggedBack: \"draggedBack\", // dragged to the start square\n    clickedAnotherPiece: \"clickedAnotherPiece\" // of the same color\n}\n\nconst DRAG_THRESHOLD = 4\n\nexport class VisualMoveInput {\n\n    constructor(view) {\n        this.view = view\n        this.chessboard = view.chessboard\n        this.moveInputState = null\n        this.fromSquare = null\n        this.toSquare = null\n\n        this.setMoveInputState(MOVE_INPUT_STATE.waitForInputStart)\n    }\n\n    moveInputStartedCallback(square) {\n        const result = this.view.moveInputStartedCallback(square)\n        if (result) {\n            this.chessboard.state.moveInputProcess = Utils.createTask()\n            this.chessboard.state.moveInputProcess.then((result) => {\n                if (this.moveInputState === MOVE_INPUT_STATE.waitForInputStart ||\n                    this.moveInputState === MOVE_INPUT_STATE.moveDone) {\n                    this.view.moveInputFinishedCallback(this.fromSquare, this.toSquare, result)\n                }\n            })\n        }\n        return result\n    }\n\n    movingOverSquareCallback(fromSquare, toSquare) {\n        this.view.movingOverSquareCallback(fromSquare, toSquare)\n    }\n\n    validateMoveInputCallback(fromSquare, toSquare) {\n        const result = this.view.validateMoveInputCallback(fromSquare, toSquare)\n        this.chessboard.state.moveInputProcess.resolve(result)\n        return result\n    }\n\n    moveInputCanceledCallback(fromSquare, toSquare, reason) {\n        this.view.moveInputCanceledCallback(fromSquare, toSquare, reason)\n        this.chessboard.state.moveInputProcess.resolve()\n    }\n\n    setMoveInputState(newState, params = undefined) {\n        const prevState = this.moveInputState\n        this.moveInputState = newState\n\n        switch (newState) {\n\n            case MOVE_INPUT_STATE.waitForInputStart:\n                break\n\n            case MOVE_INPUT_STATE.pieceClickedThreshold:\n                if (MOVE_INPUT_STATE.waitForInputStart !== prevState && MOVE_INPUT_STATE.clickTo !== prevState) {\n                    throw new Error(\"moveInputState\")\n                }\n                if (this.pointerMoveListener) {\n                    removeEventListener(this.pointerMoveListener.type, this.pointerMoveListener)\n                    this.pointerMoveListener = null\n                }\n                if (this.pointerUpListener) {\n                    removeEventListener(this.pointerUpListener.type, this.pointerUpListener)\n                    this.pointerUpListener = null\n                }\n                this.fromSquare = params.square\n                this.toSquare = null\n                this.movedPiece = params.piece\n                this.startPoint = params.point\n                if (!this.pointerMoveListener && !this.pointerUpListener) {\n                    if (params.type === \"mousedown\") {\n                        this.pointerMoveListener = this.onPointerMove.bind(this)\n                        this.pointerMoveListener.type = \"mousemove\"\n                        addEventListener(\"mousemove\", this.pointerMoveListener)\n                        this.pointerUpListener = this.onPointerUp.bind(this)\n                        this.pointerUpListener.type = \"mouseup\"\n                        addEventListener(\"mouseup\", this.pointerUpListener)\n                    } else if (params.type === \"touchstart\") {\n                        this.pointerMoveListener = this.onPointerMove.bind(this)\n                        this.pointerMoveListener.type = \"touchmove\"\n                        addEventListener(\"touchmove\", this.pointerMoveListener)\n                        this.pointerUpListener = this.onPointerUp.bind(this)\n                        this.pointerUpListener.type = \"touchend\"\n                        addEventListener(\"touchend\", this.pointerUpListener)\n                    } else {\n                        throw Error(\"4b74af\")\n                    }\n                    if (!this.contextMenuListener) {\n                        this.contextMenuListener = this.onContextMenu.bind(this)\n                        this.chessboard.view.svg.addEventListener(\"contextmenu\", this.contextMenuListener)\n                    }\n                } else {\n                    throw Error(\"94ad0c\")\n                }\n                break\n\n            case MOVE_INPUT_STATE.clickTo:\n                if (this.draggablePiece) {\n                    Svg.removeElement(this.draggablePiece)\n                    this.draggablePiece = null\n                }\n                if (prevState === MOVE_INPUT_STATE.dragTo) {\n                    this.view.setPieceVisibility(params.square, true)\n                }\n                break\n\n            case MOVE_INPUT_STATE.secondClickThreshold:\n                if (MOVE_INPUT_STATE.clickTo !== prevState) {\n                    throw new Error(\"moveInputState\")\n                }\n                this.startPoint = params.point\n                break\n\n            case MOVE_INPUT_STATE.dragTo:\n                if (MOVE_INPUT_STATE.pieceClickedThreshold !== prevState) {\n                    throw new Error(\"moveInputState\")\n                }\n                if (this.view.chessboard.state.inputEnabled()) {\n                    this.view.setPieceVisibility(params.square, false)\n                    this.createDraggablePiece(params.piece)\n                }\n                break\n\n            case MOVE_INPUT_STATE.clickDragTo:\n                if (MOVE_INPUT_STATE.secondClickThreshold !== prevState) {\n                    throw new Error(\"moveInputState\")\n                }\n                if (this.view.chessboard.state.inputEnabled()) {\n                    this.view.setPieceVisibility(params.square, false)\n                    this.createDraggablePiece(params.piece)\n                }\n                break\n\n            case MOVE_INPUT_STATE.moveDone:\n                if ([MOVE_INPUT_STATE.dragTo, MOVE_INPUT_STATE.clickTo, MOVE_INPUT_STATE.clickDragTo].indexOf(prevState) === -1) {\n                    throw new Error(\"moveInputState\")\n                }\n                this.toSquare = params.square\n                if (this.toSquare && this.validateMoveInputCallback(this.fromSquare, this.toSquare)) {\n                    this.chessboard.movePiece(this.fromSquare, this.toSquare, prevState === MOVE_INPUT_STATE.clickTo).then(() => {\n                        if (prevState === MOVE_INPUT_STATE.clickTo) {\n                            this.view.setPieceVisibility(this.toSquare, true)\n                        }\n                        this.setMoveInputState(MOVE_INPUT_STATE.reset)\n                    })\n                } else {\n                    this.view.setPieceVisibility(this.fromSquare, true)\n                    this.setMoveInputState(MOVE_INPUT_STATE.reset)\n                }\n                break\n\n            case MOVE_INPUT_STATE.reset:\n                if (this.fromSquare && !this.toSquare && this.movedPiece) {\n                    this.chessboard.state.position.setPiece(this.fromSquare, this.movedPiece)\n                }\n                this.fromSquare = null\n                this.toSquare = null\n                this.movedPiece = null\n                if (this.draggablePiece) {\n                    Svg.removeElement(this.draggablePiece)\n                    this.draggablePiece = null\n                }\n                if (this.pointerMoveListener) {\n                    removeEventListener(this.pointerMoveListener.type, this.pointerMoveListener)\n                    this.pointerMoveListener = null\n                }\n                if (this.pointerUpListener) {\n                    removeEventListener(this.pointerUpListener.type, this.pointerUpListener)\n                    this.pointerUpListener = null\n                }\n                if (this.contextMenuListener) {\n                    removeEventListener(\"contextmenu\", this.contextMenuListener)\n                    this.contextMenuListener = null\n                }\n                this.setMoveInputState(MOVE_INPUT_STATE.waitForInputStart)\n                // set temporarily hidden pieces visible again\n                const hiddenPieces = this.view.piecesGroup.querySelectorAll(\"[visibility=hidden]\")\n                for (let i = 0; i < hiddenPieces.length; i++) {\n                    hiddenPieces[i].removeAttribute(\"visibility\")\n                }\n                break\n\n            default:\n                throw Error(`260b09: moveInputState ${newState}`)\n        }\n    }\n\n    createDraggablePiece(pieceName) {\n        // maybe I should use the existing piece from the board and don't create a new one\n        if (this.draggablePiece) {\n            throw Error(\"draggablePiece already exists\")\n        }\n        this.draggablePiece = Svg.createSvg(document.body)\n        this.draggablePiece.classList.add(\"cm-chessboard-draggable-piece\")\n        this.draggablePiece.setAttribute(\"width\", this.view.squareWidth)\n        this.draggablePiece.setAttribute(\"height\", this.view.squareHeight)\n        this.draggablePiece.setAttribute(\"style\", \"pointer-events: none\")\n        this.draggablePiece.name = pieceName\n        const spriteUrl = this.chessboard.props.assetsCache ? \"\" : this.view.getSpriteUrl()\n        const piece = Svg.addElement(this.draggablePiece, \"use\", {\n            href: `${spriteUrl}#${pieceName}`\n        })\n        const scaling = this.view.squareHeight / this.chessboard.props.style.pieces.tileSize\n        const transformScale = (this.draggablePiece.createSVGTransform())\n        transformScale.setScale(scaling, scaling)\n        piece.transform.baseVal.appendItem(transformScale)\n    }\n\n    moveDraggablePiece(x, y) {\n        this.draggablePiece.setAttribute(\"style\",\n            `pointer-events: none; position: absolute; left: ${x - (this.view.squareHeight / 2)}px; top: ${y - (this.view.squareHeight / 2)}px`)\n    }\n\n    onPointerDown(e) {\n        if (!(e.type === \"mousedown\" && e.button === 0 || e.type === \"touchstart\")) {\n            return\n        }\n        const square = e.target.getAttribute(\"data-square\")\n        if (!square) { // pointer on square\n            return\n        }\n        const pieceName = this.chessboard.getPiece(square)\n        let color\n        if (pieceName) {\n            color = pieceName ? pieceName.substring(0, 1) : null\n            // allow scrolling, if not pointed on draggable piece\n            if (color === \"w\" && this.chessboard.state.inputWhiteEnabled ||\n                color === \"b\" && this.chessboard.state.inputBlackEnabled) {\n                e.preventDefault()\n            }\n        }\n        if (this.moveInputState !== MOVE_INPUT_STATE.waitForInputStart ||\n            this.chessboard.state.inputWhiteEnabled && color === \"w\" ||\n            this.chessboard.state.inputBlackEnabled && color === \"b\") {\n            let point\n            if (e.type === \"mousedown\") {\n                point = {x: e.clientX, y: e.clientY}\n            } else if (e.type === \"touchstart\") {\n                point = {x: e.touches[0].clientX, y: e.touches[0].clientY}\n            }\n            if (this.moveInputState === MOVE_INPUT_STATE.waitForInputStart && pieceName && this.moveInputStartedCallback(square)) {\n                this.setMoveInputState(MOVE_INPUT_STATE.pieceClickedThreshold, {\n                    square: square,\n                    piece: pieceName,\n                    point: point,\n                    type: e.type\n                })\n            } else if (this.moveInputState === MOVE_INPUT_STATE.clickTo) {\n                if (square === this.fromSquare) {\n                    this.setMoveInputState(MOVE_INPUT_STATE.secondClickThreshold, {\n                        square: square,\n                        piece: pieceName,\n                        point: point,\n                        type: e.type\n                    })\n                } else {\n                    const pieceName = this.chessboard.getPiece(square)\n                    const pieceColor = pieceName ? pieceName.substring(0, 1) : null\n                    const startPieceName = this.chessboard.getPiece(this.fromSquare)\n                    const startPieceColor = startPieceName ? startPieceName.substring(0, 1) : null\n                    if (color && startPieceColor === pieceColor) {\n                        this.moveInputCanceledCallback(this.fromSquare, square, MOVE_CANCELED_REASON.clickedAnotherPiece)\n                        if (this.moveInputStartedCallback(square)) {\n                            this.setMoveInputState(MOVE_INPUT_STATE.pieceClickedThreshold, {\n                                square: square,\n                                piece: pieceName,\n                                point: point,\n                                type: e.type\n                            })\n                        } else {\n                            this.setMoveInputState(MOVE_INPUT_STATE.reset)\n                        }\n                    } else {\n                        this.setMoveInputState(MOVE_INPUT_STATE.moveDone, {square: square})\n                    }\n                }\n            }\n        }\n    }\n\n    onPointerMove(e) {\n        let pageX, pageY, clientX, clientY, target\n        if (e.type === \"mousemove\") {\n            clientX = e.clientX\n            clientY = e.clientY\n            pageX = e.pageX\n            pageY = e.pageY\n            target = e.target\n        } else if (e.type === \"touchmove\") {\n            clientX = e.touches[0].clientX\n            clientY = e.touches[0].clientY\n            pageX = e.touches[0].pageX\n            pageY = e.touches[0].pageY\n            target = document.elementFromPoint(clientX, clientY)\n        }\n        if (this.moveInputState === MOVE_INPUT_STATE.pieceClickedThreshold || this.moveInputState === MOVE_INPUT_STATE.secondClickThreshold) {\n            if (Math.abs(this.startPoint.x - clientX) > DRAG_THRESHOLD || Math.abs(this.startPoint.y - clientY) > DRAG_THRESHOLD) {\n                if (this.moveInputState === MOVE_INPUT_STATE.secondClickThreshold) {\n                    this.setMoveInputState(MOVE_INPUT_STATE.clickDragTo, {\n                        square: this.fromSquare,\n                        piece: this.movedPiece\n                    })\n                } else {\n                    this.setMoveInputState(MOVE_INPUT_STATE.dragTo, {square: this.fromSquare, piece: this.movedPiece})\n                }\n                if (this.view.chessboard.state.inputEnabled()) {\n                    this.moveDraggablePiece(pageX, pageY)\n                }\n            }\n        } else if (this.moveInputState === MOVE_INPUT_STATE.dragTo || this.moveInputState === MOVE_INPUT_STATE.clickDragTo || this.moveInputState === MOVE_INPUT_STATE.clickTo) {\n            if (target && target.getAttribute && target.parentElement === this.view.boardGroup) {\n                const square = target.getAttribute(\"data-square\")\n                if (square !== this.fromSquare && square !== this.toSquare) {\n                    this.toSquare = square\n                    this.movingOverSquareCallback(this.fromSquare, this.toSquare)\n                } else if (square === this.fromSquare && this.toSquare !== null) {\n                    this.toSquare = null\n                    this.movingOverSquareCallback(this.fromSquare, null)\n                }\n            } else if (this.toSquare !== null) {\n                this.toSquare = null\n                this.movingOverSquareCallback(this.fromSquare, null)\n            }\n\n            if (this.view.chessboard.state.inputEnabled() && (this.moveInputState === MOVE_INPUT_STATE.dragTo || this.moveInputState === MOVE_INPUT_STATE.clickDragTo)) {\n                this.moveDraggablePiece(pageX, pageY)\n            }\n        }\n    }\n\n    onPointerUp(e) {\n        let target\n        if (e.type === \"mouseup\") {\n            target = e.target\n        } else if (e.type === \"touchend\") {\n            target = document.elementFromPoint(e.changedTouches[0].clientX, e.changedTouches[0].clientY)\n        }\n        if (target && target.getAttribute) {\n            const square = target.getAttribute(\"data-square\")\n\n            if (square) {\n                if (this.moveInputState === MOVE_INPUT_STATE.dragTo || this.moveInputState === MOVE_INPUT_STATE.clickDragTo) {\n                    if (this.fromSquare === square) {\n                        if (this.moveInputState === MOVE_INPUT_STATE.clickDragTo) {\n                            this.chessboard.state.position.setPiece(this.fromSquare, this.movedPiece)\n                            this.view.setPieceVisibility(this.fromSquare)\n                            this.moveInputCanceledCallback(square, null, MOVE_CANCELED_REASON.draggedBack)\n                            this.setMoveInputState(MOVE_INPUT_STATE.reset)\n                        } else {\n                            this.setMoveInputState(MOVE_INPUT_STATE.clickTo, {square: square})\n                        }\n                    } else {\n                        this.setMoveInputState(MOVE_INPUT_STATE.moveDone, {square: square})\n                    }\n                } else if (this.moveInputState === MOVE_INPUT_STATE.pieceClickedThreshold) {\n                    this.setMoveInputState(MOVE_INPUT_STATE.clickTo, {square: square})\n                } else if (this.moveInputState === MOVE_INPUT_STATE.secondClickThreshold) {\n                    this.setMoveInputState(MOVE_INPUT_STATE.reset)\n                    this.moveInputCanceledCallback(square, null, MOVE_CANCELED_REASON.secondClick)\n                }\n            } else {\n                this.view.redrawPieces()\n                const moveStartSquare = this.fromSquare\n                this.setMoveInputState(MOVE_INPUT_STATE.reset)\n                this.moveInputCanceledCallback(moveStartSquare, null, MOVE_CANCELED_REASON.movedOutOfBoard)\n            }\n        } else {\n            this.view.redrawPieces()\n            this.setMoveInputState(MOVE_INPUT_STATE.reset)\n        }\n    }\n\n    onContextMenu(e) { // while moving\n        e.preventDefault()\n        this.view.redrawPieces()\n        this.setMoveInputState(MOVE_INPUT_STATE.reset)\n        this.moveInputCanceledCallback(this.fromSquare, null, MOVE_CANCELED_REASON.secondaryClick)\n    }\n\n    isDragging() {\n        return this.moveInputState === MOVE_INPUT_STATE.dragTo || this.moveInputState === MOVE_INPUT_STATE.clickDragTo\n    }\n\n    destroy() {\n        this.setMoveInputState(MOVE_INPUT_STATE.reset)\n    }\n\n}\n","/**\n * Author and copyright: Stefan Haack (https://shaack.com)\n * Repository: https://github.com/shaack/cm-chessboard\n * License: MIT, see file 'LICENSE'\n */\n\nimport {VisualMoveInput} from \"./VisualMoveInput.js\"\nimport {Position} from \"../model/Position.js\"\nimport {EXTENSION_POINT} from \"../model/Extension.js\"\nimport {Svg} from \"../lib/Svg.js\"\nimport {Utils} from \"../lib/Utils.js\"\n\nexport const COLOR = {\n    white: \"w\",\n    black: \"b\"\n}\nexport const INPUT_EVENT_TYPE = {\n    moveInputStarted: \"moveInputStarted\",\n    movingOverSquare: \"movingOverSquare\", // while dragging or hover after click\n    validateMoveInput: \"validateMoveInput\",\n    moveInputCanceled: \"moveInputCanceled\",\n    moveInputFinished: \"moveInputFinished\"\n}\nexport const POINTER_EVENTS = {\n    pointercancel: \"pointercancel\",\n    pointerdown: \"pointerdown\",\n    pointerenter: \"pointerenter\",\n    pointerleave: \"pointerleave\",\n    pointermove: \"pointermove\",\n    pointerout: \"pointerout\",\n    pointerover: \"pointerover\",\n    pointerup: \"pointerup\"\n}\nexport const BORDER_TYPE = {\n    none: \"none\", // no border\n    thin: \"thin\", // thin border\n    frame: \"frame\" // wide border with coordinates in it\n}\n\nexport class ChessboardView {\n    constructor(chessboard) {\n        this.chessboard = chessboard\n        this.visualMoveInput = new VisualMoveInput(this)\n        if (chessboard.props.assetsCache) {\n            this.cacheSpriteToDiv(\"cm-chessboard-sprite\", this.getSpriteUrl())\n        }\n        this.container = document.createElement(\"div\")\n        this.chessboard.context.appendChild(this.container)\n        if (chessboard.props.responsive) {\n            if (typeof ResizeObserver !== \"undefined\") {\n                this.resizeObserver = new ResizeObserver(() => {\n                    setTimeout(() => { // prevents \"ResizeObserver loop completed with undelivered notifications.\"\n                        this.handleResize()\n                    })\n                })\n                this.resizeObserver.observe(this.chessboard.context)\n            } else {\n                this.resizeListener = this.handleResize.bind(this)\n                window.addEventListener(\"resize\", this.resizeListener)\n            }\n        }\n        this.positionsAnimationTask = Promise.resolve()\n        this.pointerDownListener = this.pointerDownHandler.bind(this)\n        this.container.addEventListener(\"mousedown\", this.pointerDownListener)\n        this.container.addEventListener(\"touchstart\", this.pointerDownListener, {passive: false})\n        this.createSvgAndGroups()\n        this.handleResize()\n    }\n\n    pointerDownHandler(e) {\n        this.visualMoveInput.onPointerDown(e)\n    }\n\n    destroy() {\n        this.visualMoveInput.destroy()\n        if (this.resizeObserver) {\n            this.resizeObserver.unobserve(this.chessboard.context)\n        }\n        if (this.resizeListener) {\n            window.removeEventListener(\"resize\", this.resizeListener)\n        }\n        this.chessboard.context.removeEventListener(\"mousedown\", this.pointerDownListener)\n        this.chessboard.context.removeEventListener(\"touchstart\", this.pointerDownListener)\n        Svg.removeElement(this.svg)\n        this.container.remove()\n    }\n\n    // Sprite //\n\n    cacheSpriteToDiv(wrapperId, url) {\n        if (!document.getElementById(wrapperId)) {\n            const wrapper = document.createElement(\"div\")\n            wrapper.style.transform = \"scale(0)\"\n            wrapper.style.position = \"absolute\"\n            wrapper.setAttribute(\"aria-hidden\", \"true\")\n            wrapper.id = wrapperId\n            document.body.appendChild(wrapper)\n            const xhr = new XMLHttpRequest()\n            xhr.open(\"GET\", url, true)\n            xhr.onload = function () {\n                wrapper.insertAdjacentHTML('afterbegin', xhr.response)\n            }\n            xhr.send()\n        }\n    }\n\n    createSvgAndGroups() {\n        this.svg = Svg.createSvg(this.container)\n        // let description = document.createElement(\"description\")\n        // description.innerText = \"Chessboard\"\n        // description.id = \"svg-description\"\n        // this.svg.appendChild(description)\n        let cssClass = this.chessboard.props.style.cssClass ? this.chessboard.props.style.cssClass : \"default\"\n        this.svg.setAttribute(\"class\", \"cm-chessboard border-type-\" + this.chessboard.props.style.borderType + \" \" + cssClass)\n        // this.svg.setAttribute(\"aria-describedby\", \"svg-description\")\n        this.svg.setAttribute(\"role\", \"img\")\n        this.updateMetrics()\n        this.boardGroup = Svg.addElement(this.svg, \"g\", {class: \"board\"})\n        this.coordinatesGroup = Svg.addElement(this.svg, \"g\", {class: \"coordinates\", \"aria-hidden\": \"true\"})\n        this.markersLayer = Svg.addElement(this.svg, \"g\", {class: \"markers-layer\"})\n        this.piecesLayer = Svg.addElement(this.svg, \"g\", {class: \"pieces-layer\"})\n        this.piecesGroup = Svg.addElement(this.piecesLayer, \"g\", {class: \"pieces\"})\n        this.markersTopLayer = Svg.addElement(this.svg, \"g\", {class: \"markers-top-layer\"})\n        this.interactiveTopLayer = Svg.addElement(this.svg, \"g\", {class: \"interactive-top-layer\"})\n    }\n\n    updateMetrics() {\n        const piecesTileSize = this.chessboard.props.style.pieces.tileSize\n        this.width = this.container.clientWidth\n        this.height = this.container.clientWidth * (this.chessboard.props.style.aspectRatio || 1)\n        if (this.chessboard.props.style.borderType === BORDER_TYPE.frame) {\n            this.borderSize = this.width / 25\n        } else if (this.chessboard.props.style.borderType === BORDER_TYPE.thin) {\n            this.borderSize = this.width / 320\n        } else {\n            this.borderSize = 0\n        }\n        this.innerWidth = this.width - 2 * this.borderSize\n        this.innerHeight = this.height - 2 * this.borderSize\n        this.squareWidth = this.innerWidth / 8\n        this.squareHeight = this.innerHeight / 8\n        this.scalingX = this.squareWidth / piecesTileSize\n        this.scalingY = this.squareHeight / piecesTileSize\n        this.pieceXTranslate = (this.squareWidth / 2 - piecesTileSize * this.scalingY / 2)\n    }\n\n    handleResize() {\n        this.container.style.width = (this.chessboard.context.clientWidth) + \"px\"\n        this.container.style.height = (this.chessboard.context.clientWidth * this.chessboard.props.style.aspectRatio) + \"px\"\n        if (this.container.clientWidth !== this.width || this.container.clientHeight !== this.height) {\n            this.updateMetrics()\n            this.redrawBoard()\n            this.redrawPieces()\n        }\n        this.svg.setAttribute(\"width\", \"100%\")\n        this.svg.setAttribute(\"height\", \"100%\")\n    }\n\n    redrawBoard() {\n        this.chessboard.state.invokeExtensionPoints(EXTENSION_POINT.beforeRedrawBoard)\n        this.redrawSquares()\n        this.drawCoordinates()\n        this.chessboard.state.invokeExtensionPoints(EXTENSION_POINT.afterRedrawBoard)\n        this.visualizeInputState()\n    }\n\n    // Board //\n\n    redrawSquares() {\n        while (this.boardGroup.firstChild) {\n            this.boardGroup.removeChild(this.boardGroup.lastChild)\n        }\n\n        let boardBorder = Svg.addElement(this.boardGroup, \"rect\", {width: this.width, height: this.height})\n        boardBorder.setAttribute(\"class\", \"border\")\n        if (this.chessboard.props.style.borderType === BORDER_TYPE.frame) {\n            const innerPos = this.borderSize\n            let borderInner = Svg.addElement(this.boardGroup, \"rect\", {\n                x: innerPos, y: innerPos, width: this.width - innerPos * 2, height: this.height - innerPos * 2\n            })\n            borderInner.setAttribute(\"class\", \"border-inner\")\n        }\n\n        for (let i = 0; i < 64; i++) {\n            const index = this.chessboard.state.orientation === COLOR.white ? i : 63 - i\n            const squareColor = ((9 * index) & 8) === 0 ? 'black' : 'white'\n            const fieldClass = `square ${squareColor}`\n            const point = this.squareToPoint(Position.indexToSquare(index))\n            const squareRect = Svg.addElement(this.boardGroup, \"rect\", {\n                x: point.x, y: point.y, width: this.squareWidth, height: this.squareHeight\n            })\n            squareRect.setAttribute(\"class\", fieldClass)\n            squareRect.setAttribute(\"data-square\", Position.indexToSquare(index))\n        }\n    }\n\n    drawCoordinates() {\n        if (!this.chessboard.props.style.showCoordinates) {\n            return\n        }\n        while (this.coordinatesGroup.firstChild) {\n            this.coordinatesGroup.removeChild(this.coordinatesGroup.lastChild)\n        }\n        const inline = this.chessboard.props.style.borderType !== BORDER_TYPE.frame\n        for (let file = 0; file < 8; file++) {\n            let x = this.borderSize + (17 + this.chessboard.props.style.pieces.tileSize * file) * this.scalingX\n            let y = this.height - this.scalingY * 3.5\n            let cssClass = \"coordinate file\"\n            if (inline) {\n                x = x + this.scalingX * 15.5\n                cssClass += file % 2 ? \" white\" : \" black\"\n            }\n            const textElement = Svg.addElement(this.coordinatesGroup, \"text\", {\n                class: cssClass, x: x, y: y, style: `font-size: ${this.scalingY * 10}px`\n            })\n            if (this.chessboard.state.orientation === COLOR.white) {\n                textElement.textContent = String.fromCharCode(97 + file)\n            } else {\n                textElement.textContent = String.fromCharCode(104 - file)\n            }\n        }\n        for (let rank = 0; rank < 8; rank++) {\n            let x = (this.borderSize / 3.7)\n            let y = this.borderSize + 25 * this.scalingY + rank * this.squareHeight\n            let cssClass = \"coordinate rank\"\n            if (inline) {\n                cssClass += rank % 2 ? \" black\" : \" white\"\n                if (this.chessboard.props.style.borderType === BORDER_TYPE.frame) {\n                    x = x + this.scalingX * 10\n                    y = y - this.scalingY * 15\n                } else {\n                    x = x + this.scalingX * 2\n                    y = y - this.scalingY * 15\n                }\n            }\n            const textElement = Svg.addElement(this.coordinatesGroup, \"text\", {\n                class: cssClass, x: x, y: y, style: `font-size: ${this.scalingY * 10}px`\n            })\n            if (this.chessboard.state.orientation === COLOR.white) {\n                textElement.textContent = \"\" + (8 - rank)\n            } else {\n                textElement.textContent = \"\" + (1 + rank)\n            }\n        }\n    }\n\n    // Pieces //\n\n    redrawPieces(squares = this.chessboard.state.position.squares) {\n        const childNodes = Array.from(this.piecesGroup.childNodes)\n        const isDragging = this.visualMoveInput.isDragging()\n        for (let i = 0; i < 64; i++) {\n            const pieceName = squares[i]\n            if (pieceName) {\n                const square = Position.indexToSquare(i)\n                this.drawPieceOnSquare(square, pieceName, isDragging && square === this.visualMoveInput.fromSquare)\n            }\n        }\n        for (const childNode of childNodes) {\n            this.piecesGroup.removeChild(childNode)\n        }\n    }\n\n    drawPiece(parentGroup, pieceName, point) {\n        const pieceGroup = Svg.addElement(parentGroup, \"g\", {})\n        pieceGroup.setAttribute(\"data-piece\", pieceName)\n        const transform = (this.svg.createSVGTransform())\n        transform.setTranslate(point.x, point.y)\n        pieceGroup.transform.baseVal.appendItem(transform)\n        const spriteUrl = this.chessboard.props.assetsCache ? \"\" : this.getSpriteUrl()\n        const pieceUse = Svg.addElement(pieceGroup, \"use\", {\n            href: `${spriteUrl}#${pieceName}`, class: \"piece\"\n        })\n        const transformScale = (this.svg.createSVGTransform())\n        transformScale.setScale(this.scalingY, this.scalingY)\n        pieceUse.transform.baseVal.appendItem(transformScale)\n        return pieceGroup\n    }\n\n    drawPieceOnSquare(square, pieceName, hidden = false) {\n        const pieceGroup = Svg.addElement(this.piecesGroup, \"g\", {})\n        pieceGroup.setAttribute(\"data-piece\", pieceName)\n        pieceGroup.setAttribute(\"data-square\", square)\n        if (hidden) {\n            pieceGroup.setAttribute(\"visibility\", \"hidden\")\n        }\n        const point = this.squareToPoint(square)\n        const transform = (this.svg.createSVGTransform())\n        transform.setTranslate(point.x, point.y)\n        pieceGroup.transform.baseVal.appendItem(transform)\n        const spriteUrl = this.chessboard.props.assetsCache ? \"\" : this.getSpriteUrl()\n        const pieceUse = Svg.addElement(pieceGroup, \"use\", {\n            href: `${spriteUrl}#${pieceName}`, class: \"piece\"\n        })\n        // center on square\n        const transformTranslate = (this.svg.createSVGTransform())\n        transformTranslate.setTranslate(this.pieceXTranslate, 0)\n        pieceUse.transform.baseVal.appendItem(transformTranslate)\n        // scale\n        const transformScale = (this.svg.createSVGTransform())\n        transformScale.setScale(this.scalingY, this.scalingY)\n        pieceUse.transform.baseVal.appendItem(transformScale)\n        return pieceGroup\n    }\n\n    setPieceVisibility(square, visible = true) {\n        const piece = this.getPieceElement(square)\n        if (piece) {\n            if (visible) {\n                piece.setAttribute(\"visibility\", \"visible\")\n            } else {\n                piece.setAttribute(\"visibility\", \"hidden\")\n            }\n        } else {\n            console.warn(\"no piece on\", square)\n        }\n    }\n\n    getPieceElement(square) {\n        if (!square || square.length < 2) {\n            console.warn(\"invalid square\", square)\n            return null\n        }\n        const piece = this.piecesGroup.querySelector(`g[data-square='${square}']`)\n        if (!piece) {\n            console.warn(\"no piece on\", square)\n            return null\n        }\n        return piece\n    }\n\n    // enable and disable move input //\n\n    enableMoveInput(eventHandler, color = null) {\n        if (this.chessboard.state.moveInputCallback) {\n            throw Error(\"moveInput already enabled\")\n        }\n        if (color === COLOR.white) {\n            this.chessboard.state.inputWhiteEnabled = true\n        } else if (color === COLOR.black) {\n            this.chessboard.state.inputBlackEnabled = true\n        } else {\n            this.chessboard.state.inputWhiteEnabled = true\n            this.chessboard.state.inputBlackEnabled = true\n        }\n        this.chessboard.state.moveInputCallback = eventHandler\n        this.chessboard.state.invokeExtensionPoints(EXTENSION_POINT.moveInputToggled, {enabled: true, color: color})\n        this.visualizeInputState()\n    }\n\n    disableMoveInput() {\n        this.chessboard.state.inputWhiteEnabled = false\n        this.chessboard.state.inputBlackEnabled = false\n        this.chessboard.state.moveInputCallback = null\n        this.chessboard.state.invokeExtensionPoints(EXTENSION_POINT.moveInputToggled, {enabled: false})\n        this.visualizeInputState()\n    }\n\n    // callbacks //\n\n    moveInputStartedCallback(square) {\n        const data = {\n            chessboard: this.chessboard,\n            type: INPUT_EVENT_TYPE.moveInputStarted,\n            square: square, /** square is deprecated, use squareFrom (2023-05-22) */\n            squareFrom: square,\n            piece: this.chessboard.getPiece(square)\n        }\n        if (this.chessboard.state.moveInputCallback) {\n            data.moveInputCallbackResult = this.chessboard.state.moveInputCallback(data)\n        }\n        this.chessboard.state.invokeExtensionPoints(EXTENSION_POINT.moveInput, data)\n        return data.moveInputCallbackResult\n    }\n\n    movingOverSquareCallback(squareFrom, squareTo) {\n        const data = {\n            chessboard: this.chessboard,\n            type: INPUT_EVENT_TYPE.movingOverSquare,\n            squareFrom: squareFrom,\n            squareTo: squareTo,\n            piece: this.chessboard.getPiece(squareFrom)\n        }\n        if (this.chessboard.state.moveInputCallback) {\n            data.moveInputCallbackResult = this.chessboard.state.moveInputCallback(data)\n        }\n        this.chessboard.state.invokeExtensionPoints(EXTENSION_POINT.moveInput, data)\n    }\n\n    validateMoveInputCallback(squareFrom, squareTo) {\n        const data = {\n            chessboard: this.chessboard,\n            type: INPUT_EVENT_TYPE.validateMoveInput,\n            squareFrom: squareFrom,\n            squareTo: squareTo,\n            piece: this.chessboard.getPiece(squareFrom)\n        }\n        if (this.chessboard.state.moveInputCallback) {\n            data.moveInputCallbackResult = this.chessboard.state.moveInputCallback(data)\n        }\n        this.chessboard.state.invokeExtensionPoints(EXTENSION_POINT.moveInput, data)\n        return data.moveInputCallbackResult\n    }\n\n    moveInputCanceledCallback(squareFrom, squareTo, reason) {\n        const data = {\n            chessboard: this.chessboard,\n            type: INPUT_EVENT_TYPE.moveInputCanceled,\n            reason: reason,\n            squareFrom: squareFrom,\n            squareTo: squareTo\n        }\n        if (this.chessboard.state.moveInputCallback) {\n            this.chessboard.state.moveInputCallback(data)\n        }\n        this.chessboard.state.invokeExtensionPoints(EXTENSION_POINT.moveInput, data)\n    }\n\n    moveInputFinishedCallback(squareFrom, squareTo, legalMove) {\n        const data = {\n            chessboard: this.chessboard,\n            type: INPUT_EVENT_TYPE.moveInputFinished,\n            squareFrom: squareFrom,\n            squareTo: squareTo,\n            legalMove: legalMove\n        }\n        if (this.chessboard.state.moveInputCallback) {\n            this.chessboard.state.moveInputCallback(data)\n        }\n        this.chessboard.state.invokeExtensionPoints(EXTENSION_POINT.moveInput, data)\n    }\n\n    // Helpers //\n\n    visualizeInputState() {\n        if (this.chessboard.state) { // fix https://github.com/shaack/cm-chessboard/issues/47\n            if (this.chessboard.state.inputWhiteEnabled || this.chessboard.state.inputBlackEnabled) {\n                this.boardGroup.setAttribute(\"class\", \"board input-enabled\")\n            } else {\n                this.boardGroup.setAttribute(\"class\", \"board\")\n            }\n        }\n    }\n\n    indexToPoint(index) {\n        let x, y\n        if (this.chessboard.state.orientation === COLOR.white) {\n            x = this.borderSize + (index % 8) * this.squareWidth\n            y = this.borderSize + (7 - Math.floor(index / 8)) * this.squareHeight\n        } else {\n            x = this.borderSize + (7 - index % 8) * this.squareWidth\n            y = this.borderSize + (Math.floor(index / 8)) * this.squareHeight\n        }\n        return {x: x, y: y}\n    }\n\n    squareToPoint(square) {\n        const index = Position.squareToIndex(square)\n        return this.indexToPoint(index)\n    }\n\n    getSpriteUrl() {\n        if (Utils.isAbsoluteUrl(this.chessboard.props.style.pieces.file)) {\n            return this.chessboard.props.style.pieces.file\n        } else {\n            return this.chessboard.props.assetsUrl + this.chessboard.props.style.pieces.file\n        }\n    }\n}\n","/**\n * Author and copyright: Stefan Haack (https://shaack.com)\n * Repository: https://github.com/shaack/cm-chessboard\n * License: MIT, see file 'LICENSE'\n */\n\nimport {ChessboardState} from \"./model/ChessboardState.js\"\nimport {FEN, Position} from \"./model/Position.js\"\nimport {PositionAnimationsQueue} from \"./view/PositionAnimationsQueue.js\"\nimport {EXTENSION_POINT} from \"./model/Extension.js\"\nimport {ChessboardView, COLOR, INPUT_EVENT_TYPE, BORDER_TYPE, POINTER_EVENTS} from \"./view/ChessboardView.js\"\nimport {Utils} from \"./lib/Utils.js\"\n\nexport const PIECE = {\n    wp: \"wp\", wb: \"wb\", wn: \"wn\", wr: \"wr\", wq: \"wq\", wk: \"wk\",\n    bp: \"bp\", bb: \"bb\", bn: \"bn\", br: \"br\", bq: \"bq\", bk: \"bk\"\n}\nexport const PIECE_TYPE = {\n    pawn: \"p\", knight: \"n\", bishop: \"b\", rook: \"r\", queen: \"q\", king: \"k\"\n}\nexport const PIECES_FILE_TYPE = {\n    svgSprite: \"svgSprite\"\n}\nexport {COLOR}\nexport {INPUT_EVENT_TYPE}\nexport {POINTER_EVENTS}\nexport {BORDER_TYPE}\nexport {FEN}\n\nexport class Chessboard {\n\n    constructor(context, props = {}) {\n        if (!context) {\n            throw new Error(\"container element is \" + context)\n        }\n        this.context = context\n        this.id = (Math.random() + 1).toString(36).substring(2, 8)\n        this.extensions = []\n        this.props = {\n            position: FEN.empty, // set position as fen, use FEN.start or FEN.empty as shortcuts\n            orientation: COLOR.white, // white on bottom\n            responsive: true, // resize the board automatically to the size of the context element\n            assetsUrl: \"./assets/\", // put all css and sprites in this folder, will be ignored for absolute urls of assets files\n            assetsCache: true, // cache the sprites, deactivate if you want to use multiple pieces sets in one page\n            style: {\n                cssClass: \"default\", // set the css theme of the board, try \"green\", \"blue\" or \"chess-club\"\n                showCoordinates: true, // show ranks and files\n                borderType: BORDER_TYPE.none, // \"thin\" thin border, \"frame\" wide border with coordinates in it, \"none\" no border\n                aspectRatio: 1, // height/width of the board\n                pieces: {\n                    type: PIECES_FILE_TYPE.svgSprite, // pieces are in an SVG sprite, no other type supported for now\n                    file: \"pieces/standard.svg\", // the filename of the sprite in `assets/pieces/` or an absolute url like `https://` or `/`\n                    tileSize: 40 // the tile size in the sprite\n                },\n                animationDuration: 300 // pieces animation duration in milliseconds. Disable all animations with `0`\n            },\n            extensions: [ /* {class: ExtensionClass, props: { ... }} */] // add extensions here\n        }\n        Utils.mergeObjects(this.props, props)\n        this.state = new ChessboardState()\n        this.view = new ChessboardView(this)\n        this.positionAnimationsQueue = new PositionAnimationsQueue(this)\n        this.state.orientation = this.props.orientation\n        // instantiate extensions\n        for (const extensionData of this.props.extensions) {\n            this.addExtension(extensionData.class, extensionData.props)\n        }\n        this.view.redrawBoard()\n        this.state.position = new Position(this.props.position)\n        this.view.redrawPieces()\n        this.state.invokeExtensionPoints(EXTENSION_POINT.positionChanged)\n        this.initialized = Promise.resolve() // deprecated 2023-09-19 don't use this anymore\n    }\n\n    // API //\n\n    async setPiece(square, piece, animated = false) {\n        const positionFrom = this.state.position.clone()\n        this.state.position.setPiece(square, piece)\n        this.state.invokeExtensionPoints(EXTENSION_POINT.positionChanged)\n        return this.positionAnimationsQueue.enqueuePositionChange(positionFrom, this.state.position.clone(), animated)\n    }\n\n    async movePiece(squareFrom, squareTo, animated = false) {\n        const positionFrom = this.state.position.clone()\n        this.state.position.movePiece(squareFrom, squareTo)\n        this.state.invokeExtensionPoints(EXTENSION_POINT.positionChanged)\n        return this.positionAnimationsQueue.enqueuePositionChange(positionFrom, this.state.position.clone(), animated)\n    }\n\n    async setPosition(fen, animated = false) {\n        const positionFrom = this.state.position.clone()\n        const positionTo = new Position(fen)\n        if (positionFrom.getFen() !== positionTo.getFen()) {\n            this.state.position.setFen(fen)\n            this.state.invokeExtensionPoints(EXTENSION_POINT.positionChanged)\n        }\n        return this.positionAnimationsQueue.enqueuePositionChange(positionFrom, this.state.position.clone(), animated)\n    }\n\n    async setOrientation(color, animated = false) {\n        const position = this.state.position.clone()\n        if (this.boardTurning) {\n            console.warn(\"setOrientation is only once in queue allowed\")\n            return\n        }\n        this.boardTurning = true\n        return this.positionAnimationsQueue.enqueueTurnBoard(position, color, animated).then(() => {\n            this.boardTurning = false\n            this.state.invokeExtensionPoints(EXTENSION_POINT.boardChanged)\n        })\n    }\n\n    getPiece(square) {\n        return this.state.position.getPiece(square)\n    }\n\n    getPosition() {\n        return this.state.position.getFen()\n    }\n\n    getOrientation() {\n        return this.state.orientation\n    }\n\n    enableMoveInput(eventHandler, color = undefined) {\n        this.view.enableMoveInput(eventHandler, color)\n    }\n\n    disableMoveInput() {\n        this.view.disableMoveInput()\n    }\n\n    isMoveInputEnabled() {\n        return this.state.inputWhiteEnabled || this.state.inputBlackEnabled\n    }\n\n    enableSquareSelect(eventType = POINTER_EVENTS.pointerdown, eventHandler) {\n        if (!this.squareSelectListener) {\n            this.squareSelectListener = function (e) {\n                const square = e.target.getAttribute(\"data-square\")\n                eventHandler({\n                    eventType: e.type,\n                    event: e,\n                    chessboard: this,\n                    square: square\n                })\n            }\n        }\n        this.context.addEventListener(eventType, this.squareSelectListener)\n        this.state.squareSelectEnabled = true\n        this.view.visualizeInputState()\n    }\n\n    disableSquareSelect(eventType) {\n        this.context.removeEventListener(eventType, this.squareSelectListener)\n        this.squareSelectListener = undefined\n        this.state.squareSelectEnabled = false\n        this.view.visualizeInputState()\n    }\n\n    isSquareSelectEnabled() {\n        return this.state.squareSelectEnabled\n    }\n\n    addExtension(extensionClass, props) {\n        if (this.getExtension(extensionClass)) {\n            throw Error(\"extension \\\"\" + extensionClass.name + \"\\\" already added\")\n        }\n        this.extensions.push(new extensionClass(this, props))\n    }\n\n    getExtension(extensionClass) {\n        for (const extension of this.extensions) {\n            if (extension instanceof extensionClass) {\n                return extension\n            }\n        }\n        return null\n    }\n\n    destroy() {\n        this.state.invokeExtensionPoints(EXTENSION_POINT.destroy)\n        this.positionAnimationsQueue.destroy()\n        this.view.destroy()\n        this.view = undefined\n        this.state = undefined\n    }\n\n}\n","/**\n * Author and copyright: Stefan Haack (https://shaack.com)\n * Repository: https://github.com/shaack/cm-chessboard\n * License: MIT, see file 'LICENSE'\n */\nimport {Extension, EXTENSION_POINT} from \"../../model/Extension.js\"\nimport {Svg} from \"../../lib/Svg.js\"\nimport {INPUT_EVENT_TYPE} from \"../../Chessboard.js\"\nimport {Utils} from \"../../lib/Utils.js\"\n\nexport const MARKER_TYPE = {\n    frame: {class: \"marker-frame\", slice: \"markerFrame\"},\n    framePrimary: {class: \"marker-frame-primary\", slice: \"markerFrame\"},\n    frameDanger: {class: \"marker-frame-danger\", slice: \"markerFrame\"},\n    circle: {class: \"marker-circle\", slice: \"markerCircle\"},\n    circlePrimary: {class: \"marker-circle-primary\", slice: \"markerCircle\"},\n    circleDanger: {class: \"marker-circle-danger\", slice: \"markerCircle\"},\n    circleDangerFilled: {class: \"marker-circle-danger-filled\", slice: \"markerCircleFilled\"},\n    square: {class: \"marker-square\", slice: \"markerSquare\"},\n    dot: {class: \"marker-dot\", slice: \"markerDot\", position: 'above'},\n    bevel: {class: \"marker-bevel\", slice: \"markerBevel\"}\n}\n\nexport class Markers extends Extension {\n\n    /** @constructor */\n    constructor(chessboard, props = {}) {\n        super(chessboard)\n        this.registerExtensionPoint(EXTENSION_POINT.afterRedrawBoard, () => {\n            this.onRedrawBoard()\n        })\n        this.props = {\n            autoMarkers: MARKER_TYPE.frame, // set to `null` to disable autoMarkers\n            sprite: \"extensions/markers/markers.svg\" // the sprite file of the markers\n        }\n        Object.assign(this.props, props)\n        if (chessboard.props.assetsCache) {\n            chessboard.view.cacheSpriteToDiv(\"cm-chessboard-markers\", this.getSpriteUrl())\n        }\n        chessboard.addMarker = this.addMarker.bind(this)\n        chessboard.getMarkers = this.getMarkers.bind(this)\n        chessboard.removeMarkers = this.removeMarkers.bind(this)\n        chessboard.addLegalMovesMarkers = this.addLegalMovesMarkers.bind(this)\n        chessboard.removeLegalMovesMarkers = this.removeLegalMovesMarkers.bind(this)\n        this.markerGroupDown = Svg.addElement(chessboard.view.markersLayer, \"g\", {class: \"markers\"})\n        this.markerGroupUp = Svg.addElement(chessboard.view.markersTopLayer, \"g\", {class: \"markers\"})\n        this.markers = []\n        if (this.props.autoMarkers) {\n            Object.assign(this.props.autoMarkers, this.props.autoMarkers)\n            this.registerExtensionPoint(EXTENSION_POINT.moveInput, (event) => {\n                this.drawAutoMarkers(event)\n            })\n        }\n    }\n\n    drawAutoMarkers(event) {\n        if(event.type !== INPUT_EVENT_TYPE.moveInputFinished) {\n            this.removeMarkers(this.props.autoMarkers)\n        }\n        if (event.type === INPUT_EVENT_TYPE.moveInputStarted &&\n            !event.moveInputCallbackResult) {\n            return\n        }\n        if (event.type === INPUT_EVENT_TYPE.moveInputStarted ||\n            event.type === INPUT_EVENT_TYPE.movingOverSquare) {\n            if (event.squareFrom) {\n                this.addMarker(this.props.autoMarkers, event.squareFrom)\n            }\n            if (event.squareTo) {\n                this.addMarker(this.props.autoMarkers, event.squareTo)\n            }\n        }\n    }\n\n    onRedrawBoard() {\n        while (this.markerGroupUp.firstChild) {\n            this.markerGroupUp.removeChild(this.markerGroupUp.firstChild)\n        }\n        while (this.markerGroupDown.firstChild) {\n            this.markerGroupDown.removeChild(this.markerGroupDown.firstChild)\n        }\n        this.markers.forEach((marker) => {\n                this.drawMarker(marker)\n            }\n        )\n    }\n\n    addLegalMovesMarkers(moves) {\n        for (const move of moves) {\n            if (move.promotion && move.promotion !== \"q\") {\n                continue\n            }\n            if (this.chessboard.getPiece(move.to)) {\n                this.chessboard.addMarker(MARKER_TYPE.bevel, move.to)\n            } else {\n                this.chessboard.addMarker(MARKER_TYPE.dot, move.to)\n            }\n        }\n    }\n\n    removeLegalMovesMarkers() {\n        this.chessboard.removeMarkers(MARKER_TYPE.bevel)\n        this.chessboard.removeMarkers(MARKER_TYPE.dot)\n    }\n\n    drawMarker(marker) {\n        let markerGroup\n        if (marker.type.position === 'above') {\n            markerGroup = Svg.addElement(this.markerGroupUp, \"g\")\n        } else {\n            markerGroup = Svg.addElement(this.markerGroupDown, \"g\")\n        }\n        markerGroup.setAttribute(\"data-square\", marker.square)\n        const point = this.chessboard.view.squareToPoint(marker.square)\n        const transform = (this.chessboard.view.svg.createSVGTransform())\n        transform.setTranslate(point.x, point.y)\n        markerGroup.transform.baseVal.appendItem(transform)\n        const spriteUrl = this.chessboard.props.assetsCache ? \"\" : this.getSpriteUrl()\n        const markerUse = Svg.addElement(markerGroup, \"use\",\n            {href: `${spriteUrl}#${marker.type.slice}`, class: \"marker \" + marker.type.class})\n        const transformScale = (this.chessboard.view.svg.createSVGTransform())\n        transformScale.setScale(this.chessboard.view.scalingX, this.chessboard.view.scalingY)\n        markerUse.transform.baseVal.appendItem(transformScale)\n        return markerGroup\n    }\n\n    addMarker(type, square) {\n        if (typeof type === \"string\" || typeof square === \"object\") { // todo remove 2022-12-01\n            console.error(\"changed the signature of `addMarker` to `(type, square)` with v5.1.x\")\n            return\n        }\n        this.markers.push(new Marker(square, type))\n        this.onRedrawBoard()\n    }\n\n    getMarkers(type = undefined, square = undefined) {\n        if (typeof type === \"string\" || typeof square === \"object\") { // todo remove 2022-12-01\n            console.error(\"changed the signature of `getMarkers` to `(type, square)` with v5.1.x\")\n            return\n        }\n        let markersFound = []\n        this.markers.forEach((marker) => {\n            if (marker.matches(square, type)) {\n                markersFound.push(marker)\n            }\n        })\n        return markersFound\n    }\n\n    removeMarkers(type = undefined, square = undefined) {\n        if (typeof type === \"string\" || typeof square === \"object\") { // todo remove 2022-12-01\n            console.error(\"changed the signature of `removeMarkers` to `(type, square)` with v5.1.x\")\n            return\n        }\n        this.markers = this.markers.filter((marker) => !marker.matches(square, type))\n        this.onRedrawBoard()\n    }\n\n    getSpriteUrl() {\n        if(Utils.isAbsoluteUrl(this.props.sprite)) {\n            return this.props.sprite\n        } else {\n            return this.chessboard.props.assetsUrl + this.props.sprite\n        }\n    }\n}\n\nclass Marker {\n    constructor(square, type) {\n        this.square = square\n        this.type = type\n    }\n\n    matches(square = undefined, type = undefined) {\n        if (!type && !square) {\n            return true\n        } else if (!type) {\n            if (square === this.square) {\n                return true\n            }\n        } else if (!square) {\n            if (this.type === type) {\n                return true\n            }\n        } else if (this.type === type && square === this.square) {\n            return true\n        }\n        return false\n    }\n}\n","/**\n * Author and copyright: Stefan Haack (https://shaack.com)\n * Repository: https://github.com/shaack/cm-web-modules\n * License: MIT, see file 'LICENSE'\n */\nconst events = ['click', 'touchstart', 'touchend', 'keydown', 'mousedown', 'mouseup', 'dblclick']\nlet audioProps = undefined\nwindow.cmAudioDebug = false\n\nexport const createAudioContext = (props) => {\n    audioProps = {\n        debug: false,\n        ...props\n    }\n    window.cmAudioDebug = audioProps.debug\n    window.AudioContext = window.AudioContext || window.webkitAudioContext\n    if (window.AudioContext) {\n        if (audioProps.debug) {\n            console.log('Web Audio API (AudioContext) supported by this browser')\n        }\n        window.cmAudioContext = new AudioContext()\n    } else if (window.webkitAudioContext) {\n        if (audioProps.debug) {\n            console.log('Web Audio API (window.webkitAudioContext) supported by this browser')\n        }\n        window.cmAudioContext = new webkitAudioContext()\n    } else {\n        console.error('Web Audio API is not supported by this browser')\n    }\n    window.cmMainGainNode = window.cmAudioContext.createGain()\n    window.cmMainGainNode.gain.value = 1\n    cmMainGainNode.connect(window.cmAudioContext.destination)\n    addEventListeners()\n}\n\nexport class Audio {\n\n    static context() {\n        if (!window.cmAudioContext) {\n            console.error(\"Audio.context() called before createAudioContext()\")\n        }\n        return window.cmAudioContext\n    }\n\n    static destination() {\n        return window.cmMainGainNode\n    }\n\n    static setGain(gain) {\n        window.cmMainGainNode.gain.setValueAtTime(gain, window.cmAudioContext.currentTime)\n    }\n\n    static isEnabled() {\n        return window.cmAudioContext.state === \"running\"\n    }\n\n    /*\n        Adds an event listener to the audioContext object\n        that listens for the \"statechange\" event. This event is triggered whenever the state of the AudioContext changes\n        (e.g., from \"suspended\" to \"running\" or vice versa). The listener function will be called whenever this event occurs,\n        allowing you to execute custom code in response to changes in the AudioContext state.\n     */\n    static addStateListener(listener) {\n        window.cmAudioContext.addEventListener(\"statechange\", listener)\n    }\n\n    /*\n        can be called from the UI to resume the AudioContext after user interaction\n     */\n    static resumeAudioContext() {\n        resumeAudioContext()\n    }\n\n}\n\n\nfunction addEventListeners() {\n    events.forEach(event => {\n        document.addEventListener(event, resumeAudioContext)\n    })\n    document.addEventListener('visibilitychange', () => {\n        if (!document.hidden) {\n            setTimeout(resumeAudioContext, 200)\n        }\n    })\n}\n\nfunction removeEventListeners() {\n    events.forEach(event => {\n        document.removeEventListener(event, resumeAudioContext)\n    })\n}\n\n// start context after user interaction\nfunction resumeAudioContext() {\n    if (window.cmAudioContext) {\n        if (window.cmAudioContext.state !== \"running\") {\n            window.cmAudioContext.resume().then(() => {\n                if (audioProps.debug) {\n                    console.log('AudioContext resumed successfully, state:', window.cmAudioContext.state)\n                }\n                removeEventListeners()\n            }).catch(error => {\n                console.error('Failed to resume AudioContext:', error)\n            })\n        } else {\n            console.warn('AudioContext already running')\n            removeEventListeners()\n        }\n    } else {\n        console.error(\"AudioContext not created\")\n    }\n\n}\n","/**\n * Author and copyright: Stefan Haack (https://shaack.com)\n * Repository: https://github.com/shaack/cm-web-modules\n * License: MIT, see file 'LICENSE'\n */\n\nimport {Audio} from \"./Audio.js\"\n\nexport class Sample {\n\n    constructor(src, props = {}) {\n        this.src = src\n        this.props = {\n            gain: 1,\n            startWithoutAudioContext: true // start to play, without enabled audio context\n        }\n        Object.assign(this.props, props)\n        this.gainNode = Audio.context().createGain()\n        this.setGain(this.props.gain)\n        this.audioBuffer = null\n        this.load()\n    }\n\n    setGain(gain) {\n        if(window.cmAudioDebug) {\n            console.log(\"Sample.setGain\", gain)\n        }\n        this.gainNode.gain.setValueAtTime(gain, Audio.context().currentTime)\n    }\n\n    play(when = undefined, offset = undefined, duration = undefined) {\n        if(window.cmAudioDebug) {\n            console.log(\"Sample.play\", this.src, when, offset, duration)\n        }\n        if (this.props.startWithoutAudioContext || Audio.isEnabled()) {\n            this.loading.then(() => {\n                let source\n                source = this.createBufferSource()\n                source.start(when, offset, duration)\n            })\n        }\n\n    }\n\n    createBufferSource() {\n        const source = Audio.context().createBufferSource()\n        source.buffer = this.audioBuffer\n        source.connect(this.gainNode)\n        this.gainNode.connect(Audio.destination())\n        return source\n    }\n\n    load() {\n        this.loading = new Promise(((resolve, reject) => {\n            const request = new XMLHttpRequest()\n            request.open('GET', this.src, true)\n            request.responseType = 'arraybuffer'\n            request.onload = () => {\n                Audio.context().decodeAudioData(request.response, (audioBuffer) => {\n                    this.audioBuffer = audioBuffer\n                    resolve()\n                }, () => {\n                    console.error(\"error loading sound\", this.src)\n                    reject()\n                })\n            }\n            request.send()\n        }))\n        return this.loading\n    }\n\n}\n","/**\n * Author and copyright: Stefan Haack (https://shaack.com)\n * Repository: https://github.com/shaack/cm-chessboard-capture-them-all\n * License: MIT, see file 'LICENSE'\n */\nimport {COLOR} from \"../node_modules/cm-chessboard/src/Chessboard.js\"\nimport {MARKER_TYPE} from \"../node_modules/cm-chessboard/src/extensions/markers/Markers.js\"\nimport {Sample} from \"../node_modules/cm-web-modules/src/audio/Sample.js\"\nimport {createAudioContext} from \"../node_modules/cm-web-modules/src/audio/Audio.js\"\n\nexport class Level {\n\n    constructor(initialFen, game) {\n        this.chessboard = game.chessboard\n        this.chessboard.setPosition(initialFen, true)\n\n        if (!window.cmAudioContext) {\n            createAudioContext()\n        }\n\n        this.moveSound = new Sample(\"../node_modules/cm-web-modules/assets/move.mp3\")\n\n        this.chessboard.context.addEventListener(\"pointerdown\", (e) => {\n            const square = e.target.getAttribute(\"data-square\")\n            if (square) {\n                const piece = this.chessboard.getPiece(square)\n                const blackPieceSquare = this.chessboard.state.position.getPieces(COLOR.black)[0].square\n                if (piece && piece.charAt(0) === \"w\" && this.isValidMove(blackPieceSquare, square)) {\n                    this.chessboard.movePiece(blackPieceSquare, square, true)\n                    this.chessboard.context.style.cursor = \"\"\n                    const piecesLeft = this.chessboard.state.position.getPieces(COLOR.white).length\n                    this.moveSound.play()\n                    // console.log(\"pieces left\", piecesLeft)\n                    if(piecesLeft === 0) {\n                        game.levelFinished()\n                    }\n                }\n            }\n        })\n\n        this.chessboard.context.addEventListener(\"mouseover\", (e) => {\n            const square = e.target.getAttribute(\"data-square\")\n            this.chessboard.removeMarkers()\n            if (square) {\n                const piece = this.chessboard.getPiece(square)\n                if (piece) {\n                    e.target.style.cursor = \"pointer\"\n                    if(piece.charAt(0) === \"w\") {\n                        this.chessboard.addMarker(MARKER_TYPE.frame, square)\n                    }\n                } else {\n                    e.target.style.cursor = \"\"\n                }\n            }\n        })\n\n    }\n\n    isValidMove(squareFrom, squareTo) {\n        const piece = this.chessboard.getPiece(squareFrom)\n        switch (piece.charAt(1)) {\n            case \"r\":\n                return this.validateRookMove(squareFrom, squareTo)\n            case \"b\":\n                return this.validateBishopMove(squareFrom, squareTo)\n            case \"q\":\n                return this.validateQueenMove(squareFrom, squareTo)\n            case \"n\":\n                return this.validateKnightMove(squareFrom, squareTo)\n        }\n    }\n\n    validateRookMove(squareFrom, squareTo) {\n        const fileFrom = squareFrom.charCodeAt(0) - 97\n        const rankFrom = parseInt(squareFrom.charAt(1)) - 1\n        const fileTo = squareTo.charCodeAt(0) - 97\n        const rankTo = parseInt(squareTo.charAt(1)) - 1\n        // prevent jumping over pieces\n        if (fileFrom === fileTo) {\n            for (let rank = Math.min(rankFrom, rankTo) + 1; rank < Math.max(rankFrom, rankTo); rank++) {\n                const square = String.fromCharCode(fileFrom + 97) + (rank + 1)\n                if (this.chessboard.getPiece(square)) {\n                    return false\n                }\n            }\n        }\n        if (rankFrom === rankTo) {\n            for (let file = Math.min(fileFrom, fileTo) + 1; file < Math.max(fileFrom, fileTo); file++) {\n                const square = String.fromCharCode(file + 97) + (rankFrom + 1)\n                if (this.chessboard.getPiece(square)) {\n                    return false\n                }\n            }\n        }\n        if (fileFrom === fileTo || rankFrom === rankTo) {\n            return true\n        }\n    }\n\n    validateBishopMove(squareFrom, squareTo) {\n        const fileFrom = squareFrom.charCodeAt(0) - 97\n        const rankFrom = parseInt(squareFrom.charAt(1)) - 1\n        const fileTo = squareTo.charCodeAt(0) - 97\n        const rankTo = parseInt(squareTo.charAt(1)) - 1\n        // must move on a diagonal\n        const fileDiff = fileTo - fileFrom\n        const rankDiff = rankTo - rankFrom\n        if (Math.abs(fileDiff) !== Math.abs(rankDiff) || fileDiff === 0) {\n            return false\n        }\n        // prevent jumping over pieces by checking every intermediate square\n        const fileStep = fileDiff > 0 ? 1 : -1\n        const rankStep = rankDiff > 0 ? 1 : -1\n        for (let i = 1; i < Math.abs(fileDiff); i++) {\n            const file = fileFrom + i * fileStep\n            const rank = rankFrom + i * rankStep\n            const square = String.fromCharCode(file + 97) + (rank + 1)\n            if (this.chessboard.getPiece(square)) {\n                return false\n            }\n        }\n        return true\n    }\n\n    validateQueenMove(squareFrom, squareTo) {\n        console.log(\"validateRookMove\", this.validateRookMove(squareFrom, squareTo))\n        console.log(\"validateBishopMove\", this.validateBishopMove(squareFrom, squareTo))\n        return this.validateRookMove(squareFrom, squareTo) || this.validateBishopMove(squareFrom, squareTo)\n    }\n\n    validateKnightMove(squareFrom, squareTo) {\n        // validate knight move\n        const fileFrom = squareFrom.charCodeAt(0) - 97\n        const rankFrom = parseInt(squareFrom.charAt(1)) - 1\n        const fileTo = squareTo.charCodeAt(0) - 97\n        const rankTo = parseInt(squareTo.charAt(1)) - 1\n        if (Math.abs(fileFrom - fileTo) === 1 && Math.abs(rankFrom - rankTo) === 2) {\n            return true\n        }\n        if (Math.abs(fileFrom - fileTo) === 2 && Math.abs(rankFrom - rankTo) === 1) {\n            return true\n        }\n    }\n\n}\n","/**\n * Author and copyright: Stefan Haack (https://shaack.com)\n * Repository: https://github.com/shaack/cm-chessboard-capture-them-all\n * License: MIT, see file 'LICENSE'\n */\nexport class GameState {\n\n    constructor() {\n        if (!this.levelGroupName) {\n            this.levelGroupName = \"Rook\"\n            this.marathonMode = false\n            this.level = 0\n            this.MenuCheckpoint = \"game.html\"\n            \n            if (!localStorage.getItem(\"beatenLevels\")) {\n                this.beatenLevels = {\n                    Rook: 0,\n                    Bishop: 0,\n                    Knight: 0,\n                    Queen: 0\n                }\n            }\n        }\n    }\n\n    set levelGroupName(value) {\n        localStorage.setItem(\"levelGroupName\", JSON.stringify(value))\n    }\n\n    get levelGroupName() {\n        return JSON.parse(localStorage.getItem(\"levelGroupName\"))\n    }\n\n    set level(value) {\n        localStorage.setItem(\"level\", JSON.stringify(value))\n    }\n\n    get level() {\n        return JSON.parse(localStorage.getItem(\"level\"))\n    }\n\n    set marathonMode(bool) {\n        localStorage.setItem(\"marathonMode\", JSON.stringify(bool))\n    }\n\n    get marathonMode() {\n        return JSON.parse(localStorage.getItem(\"marathonMode\"))\n    }\n\n    set MenuCheckpoint(value) {\n        localStorage.setItem(\"MenuCheckpoint\", JSON.stringify(value))\n    }\n\n    get MenuCheckpoint() {\n        return JSON.parse(localStorage.getItem(\"MenuCheckpoint\"))\n    }\n\n    set beatenLevels(value) {\n        localStorage.setItem(\"beatenLevels\", JSON.stringify(value));\n    }\n    \n    get beatenLevels() {\n        return JSON.parse(localStorage.getItem(\"beatenLevels\")) || {\n            Rook: 0,\n            Bishop: 0,\n            Knight: 0,\n            Queen: 0\n        };\n    }\n}\n","/**\n * Author and copyright: Stefan Haack (https://shaack.com)\n * Repository: https://github.com/shaack/cm-chessboard-capture-them-all\n * License: MIT, see file 'LICENSE'\n */\n\nexport class Confetti {\n    static shoot() {\n        var count = 200;\n        var defaults = {\n            origin: { y: 0.9 }\n        };\n\n        function fire(particleRatio, opts) {\n            confetti({\n                ...defaults,\n                ...opts,\n                particleCount: Math.floor(count * particleRatio)\n            });\n        }\n        fire(0.25, {\n            spread: 26,\n            startVelocity: 55,\n        });\n        fire(0.2, {\n            spread: 60,\n        });\n        fire(0.35, {\n            spread: 100,\n            decay: 0.91,\n            scalar: 0.8\n        });\n        fire(0.1, {\n            spread: 120,\n            startVelocity: 25,\n            decay: 0.92,\n            scalar: 1.2\n        });\n        fire(0.1, {\n            spread: 120,\n            startVelocity: 45,\n        });\n    }\n}","/**\n * Author: Stefan Haack and Michael Hinz\n * Copyright: Stefan Haack (https://shaack.com)\n * Repository: https://github.com/shaack/cm-chessboard-capture-them-all\n * License: MIT, see file 'LICENSE'\n */\nimport {Chessboard} from \"../node_modules/cm-chessboard/src/Chessboard.js\"\nimport {Markers} from \"../node_modules/cm-chessboard/src/extensions/markers/Markers.js\"\nimport {createAudioContext} from \"../node_modules/cm-web-modules/src/audio/Audio.js\"\nimport {Sample} from \"../node_modules/cm-web-modules/src/audio/Sample.js\"\nimport {Level} from \"./Level.js\"\nimport {GameState} from \"./GameState.js\"\nimport {Confetti} from \"./Confetti.js\"\n\n\nexport const LEVELS = {\n    \"Rook\": [\n        \"8/8/8/8/2P1rP2/8/8/8 b - - 0 1\",\n        \"8/1P6/8/1P1r4/8/1P2P3/8/8 b - - 0 1\",\n        \"7P/8/8/4r3/8/8/1P2P2P/8 b - - 0 1\",\n        \"8/8/4P3/8/8/4P2P/1r2P3/P3P2P b - - 0 1\",\n        \"4P3/8/8/1P2r2P/8/8/1P2P3/8 b - - 0 1\",\n        \"8/1P5P/8/P3P3/8/1P1P1P2/P6P/1P1r4 b - - 0 1\",\n        \"8/2P1PP2/8/P1P1P3/8/2P3PP/6r1/6P1 b - - 0 1\",\n        \"8/8/PP3P2/8/Pr3P2/3P4/P4P2/1P1P4 b - - 0 1\",\n        \"2P4P/P3P3/8/2P4P/8/P1P2P1P/5r2/P4P2 b - - 0 1\", // zur vierten position\n        \"P7/4P2P/2P3P1/8/P1Pr4/8/1P1P2P1/P6P b - - 0 1\",\n    ],\n    \"Bishop\": [ // Bishop\n        \"8/8/4P3/1P1b4/2P5/3P4/8/8 b - - 0 1\",\n        \"8/8/P3b3/8/8/7P/8/5P2 b - - 0 1\",\n        \"4P1P1/8/P1P1P3/8/P3b3/7P/P3P3/3P1P2 b - - 0 1\",\n        \"3P1P2/2P5/1P5P/P5P1/3b4/4P1P1/8/4P3 b - - 0 1\",\n        \"8/4P1P1/3P1P1P/8/3P1b1P/8/3P1P1P/8 b - - 0 1\",\n        \"3P1P2/P1P3P1/7P/P7/5P1P/8/1b3P1P/P7 b - - 0 1\",\n        \"3P1P2/P1P3P1/7P/P7/5P1P/8/1b3P1P/P7 b - - 0 1\",\n        \"8/P3P1P1/8/2P1b1P1/7P/P3P3/1P3P2/2P3P1 b - - 0 1\",\n        \"6P1/1P5P/P7/3P4/4b3/3P3P/P5P1/1P3P2 b - - 0 1\",\n        \"3P4/6P1/3P3P/8/1P1P1b1P/8/3P1P2/8 b - - 0 1\",\n    ],\n    \"Knight\": [ // Knight\n        \"n5P1/4P3/1P5P/3P4/6P1/8/5P2/7P b - - 0 1\",\n        \"8/8/4PP2/3P3P/3n1P2/4P1P1/8/5P2 b - - 0 1\",\n        \"8/8/2P5/4P3/1P1n1P2/3P1P2/2P3P1/4P3 b - - 0 1\",\n        \"8/3P4/5P2/2P1P3/4P1P1/3P2n1/5P2/7P b - - 0 1\",\n        \"8/8/8/8/3nPPP1/3P2P1/3PPP1P/5P2 b - - 0 1\",\n        \"8/6P1/4P3/3P2PP/5P2/2P3PP/4P3/6n1 b - - 0 1\",\n        \"7P/5P2/6P1/4nP2/3P3P/1P3P2/3P4/8 b - - 0 1\",\n        \"8/4P3/8/3P1P1P/5PP1/4P1PP/7P/5Pn1 b - - 0 1\",\n        \"4P3/8/3P1P2/8/2P1n1P1/3P4/3P1P2/4P3 b - - 0 1\",\n        \"1P4P1/3PPP2/1P1P3P/3PnP2/1P2P3/3P1P2/3P4/4P3 b - - 0 1\",//\n    ],\n    \"Queen\": [ // Queen\n        \"8/8/5P2/3q2P1/8/P3P2P/6P1/P7 b - - 0 1\",\n        \"4P3/8/2q1P1P1/8/8/3P3P/8/8 b - - 0 1\",\n        \"2P5/P7/8/2P4P/P3q3/7P/4P3/5P2 b - - 0 1\",\n        \"P6P/8/2q1P2P/8/2P5/8/8/P1P4P b - - 0 1\",\n        \"1P4P1/8/4P3/8/P1q3P1/8/4P3/1P4P1 b - - 0 1\",\n        \"2P5/3P1P2/8/6P1/4q3/8/4P1P1/2P3P1 b - - 0 1\",\n        \"3P4/8/1P5P/3q4/8/4P3/8/2P4P b - - 0 1\",\n        \"1P6/4P3/5P2/1P6/4q3/2P3P1/8/8 b - - 0 1 \",\n        \"6P1/8/1P6/P5P1/3q4/1P4P1/3P1P2/8 b - - 0 1\",\n        \"4P3/1q6/2P3P2/P6P/8/5P1P/7P/1P2P3 b - - 0 1\",\n    ],\n}\n\nexport class Game {\n\n    constructor() {\n\n        if (!window.cmAudioContext) {\n            createAudioContext()\n        }\n        \n        this.buttons = document.getElementById(\"buttons\")\n        this.restartButton = document.getElementById(\"restartButton\")\n        this.menuButton = document.getElementById(\"menuButton\")\n        this.closebtn = document.getElementById(\"closebtn\")\n\n        this.restartButton.addEventListener(\"click\", this.restartLevel.bind(this))\n        this.menuButton.addEventListener(\"click\", this.openNav.bind(this))\n        this.closebtn.addEventListener(\"click\", this.closeNav.bind(this))\n\n        this.winSound = new Sample(\"./assets/winSound.mp3\")\n\n        this.chessboard = new Chessboard(document.querySelector(\".board\"), {\n            assetsUrl: \"../node_modules/cm-chessboard/assets/\",\n            style: {\n                showCoordinates: true,\n                pieces: {\n                    file: \"pieces/staunty.svg\",\n                }\n            },\n            extensions: [{class: Markers}]\n        })\n        this.state = new GameState()\n        this.restartLevel()\n    }\n\n    reloadUI() {\n        const levelGroupNameOutput = document.getElementById(\"levelGroup\")\n        const levelNumberOutput = document.getElementById(\"level\")\n        levelGroupNameOutput.innerText = this.state.levelGroupName\n        levelNumberOutput.innerText = this.state.level + 1\n    }\n\n    levelFinished() {\n        console.log(\"levelFinished, TODO win animation\")\n        const beatenLevels = this.state.beatenLevels; // Hole den aktuellen Fortschritt\n        beatenLevels[this.state.levelGroupName] = Math.max(\n            beatenLevels[this.state.levelGroupName] || 0,\n            this.state.level + 1\n        );\n        this.state.beatenLevels = beatenLevels; // Speichere den aktualisierten Fortschritt\n        setTimeout(() => {\n            this.nextLevel()\n        }, 500)\n\n    }\n\n    nextLevel() {\n        this.state.level++\n        if (!LEVELS[this.state.levelGroupName][this.state.level]) {\n            const levelGroupsCount = Object.keys(LEVELS).length\n            const levelGroupNames = Object.keys(LEVELS)\n            const currentLevelGroupNumber = levelGroupNames.indexOf(this.state.levelGroupName)\n            if (currentLevelGroupNumber < levelGroupsCount - 1 & this.state.marathonMode == false) {\n                Confetti.shoot()\n                this.winSound.play()\n                this.state.levelGroupName = levelGroupNames[currentLevelGroupNumber + 1]\n                this.state.level = 0\n                \n            } else {\n                console.log(\"game finished\")\n                this.buttons.style.display = \"none\"\n                Confetti.shoot()\n                this.winSound.play()\n                setTimeout(() => {\n                window.location.href = \"index.html\"\n                this.state.marathonMode = false\n                }, 2000)\n            }\n        }\n        this.reloadUI()\n        this.state.currentLevel = new Level(LEVELS[this.state.levelGroupName][this.state.level], this)\n    }\n\n    restartLevel() {\n        console.log(\"restartLevel\",  this.state.levelGroupName,  this.state.level)\n        this.state.currentLevel = new Level(LEVELS[this.state.levelGroupName][this.state.level], this)\n        this.currentCheckpoint()\n        this.reloadUI()\n    }\n\n    openNav() {\n        document.getElementById(\"myNav\").style.display = \"block\"\n    }\n\n    closeNav() {\n        document.getElementById(\"myNav\").style.display = \"none\"\n    }\n\n    goBack() {\n        const checkpoint = JSON.parse(localStorage.getItem(\"MenuCheckpoint\"))\n        window.location = checkpoint ? checkpoint : \"index.html\"\n    }\n\n    currentCheckpoint() {\n        localStorage.setItem(\"MenuCheckpoint\", JSON.stringify(\"game.html\"))\n    }\n}\n"],"names":["FEN","Position","constructor","fen","this","squares","Array","fill","setFen","parts","replace","split","part","row","str","numSpaces","parseInt","ret","i","c","char","substring","piece","toUpperCase","toLowerCase","getFen","spaceCounter","color","name","join","getPieces","pieceColor","undefined","pieceType","sortBy","pieces","sort","a","b","indexOf","type","charAt","square","indexToSquare","push","position","movePiece","squareFrom","squareTo","squareToIndex","console","warn","setPiece","getPiece","coordinates","squareToCoordinates","index","coordinatesToSquare","Math","floor","charCodeAt","String","fromCharCode","toString","clone","cloned","slice","ChessboardState","orientation","inputWhiteEnabled","inputBlackEnabled","squareSelectEnabled","moveInputCallback","extensionPoints","moveInputProcess","Promise","resolve","inputEnabled","invokeExtensionPoints","data","dataCloned","Object","assign","extensionPoint","returnValue","SVG_NAMESPACE","Svg","createSvg","containerElement","svg","document","createElementNS","setAttribute","appendChild","addElement","parent","attributes","element","attribute","hasOwnProperty","value","setAttributeNS","removeElement","parentNode","removeChild","EXTENSION_POINT","Extension","chessboard","registerExtensionPoint","callback","state","registerMethod","log","error","args","apply","Utils","delegate","eventName","selector","handler","eventListener","event","target","matches","call","addEventListener","remove","removeEventListener","mergeObjects","source","isObject","obj","key","keys","createDomElement","html","template","createElement","innerHTML","trim","content","firstChild","createTask","reject","promise","_resolve","_reject","isAbsoluteUrl","url","startsWith","ANIMATION_EVENT_TYPE","PromiseQueue","queue","workingOnPromise","stop","enqueue","dequeue","entry","shift","then","catch","err","destroy","CHANGE_TYPE","PositionsAnimation","view","fromPosition","toPosition","duration","animatedElements","createAnimation","frameHandle","requestAnimationFrame","animationStep","bind","positionsAnimationTask","seekChanges","fromSquares","toSquares","appearedList","disappearedList","changes","previousSquare","newSquare","forEach","appeared","shortestDistance","foundMoved","disappeared","moveDistance","squareDistance","splice","atIndex","toIndex","change","animatedItem","getPieceElement","atPoint","indexToPoint","toPoint","drawPieceOnSquare","style","opacity","time","startTime","timeDiff","cancelAnimationFrame","t","min","progress","isNaN","transform","baseVal","removeItem","createSVGTransform","setTranslate","x","y","appendItem","round","index1","index2","file1","rank1","file2","rank2","max","abs","PositionAnimationsQueue","super","enqueuePositionChange","positionFrom","positionTo","animated","props","animationDuration","length","pow","redrawPieces","enqueueTurnBoard","emptyPosition","redrawBoard","MOVE_INPUT_STATE","waitForInputStart","pieceClickedThreshold","clickTo","secondClickThreshold","dragTo","clickDragTo","moveDone","reset","MOVE_CANCELED_REASON","VisualMoveInput","moveInputState","fromSquare","toSquare","setMoveInputState","moveInputStartedCallback","result","moveInputFinishedCallback","movingOverSquareCallback","validateMoveInputCallback","moveInputCanceledCallback","reason","newState","params","prevState","Error","pointerMoveListener","pointerUpListener","movedPiece","startPoint","point","onPointerMove","onPointerUp","contextMenuListener","onContextMenu","draggablePiece","setPieceVisibility","createDraggablePiece","hiddenPieces","piecesGroup","querySelectorAll","removeAttribute","pieceName","body","classList","add","squareWidth","squareHeight","spriteUrl","assetsCache","getSpriteUrl","href","scaling","tileSize","transformScale","setScale","moveDraggablePiece","onPointerDown","e","button","getAttribute","preventDefault","clientX","clientY","touches","startPieceName","startPieceColor","pageX","pageY","elementFromPoint","parentElement","boardGroup","changedTouches","moveStartSquare","isDragging","COLOR","INPUT_EVENT_TYPE","POINTER_EVENTS","BORDER_TYPE","ChessboardView","visualMoveInput","cacheSpriteToDiv","container","context","responsive","ResizeObserver","resizeObserver","setTimeout","handleResize","observe","resizeListener","window","pointerDownListener","pointerDownHandler","passive","createSvgAndGroups","unobserve","wrapperId","getElementById","wrapper","id","xhr","XMLHttpRequest","open","onload","insertAdjacentHTML","response","send","cssClass","borderType","updateMetrics","class","coordinatesGroup","markersLayer","piecesLayer","markersTopLayer","interactiveTopLayer","piecesTileSize","width","clientWidth","height","aspectRatio","borderSize","innerWidth","innerHeight","scalingX","scalingY","pieceXTranslate","clientHeight","redrawSquares","drawCoordinates","visualizeInputState","lastChild","innerPos","fieldClass","squareToPoint","squareRect","showCoordinates","inline","file","textElement","textContent","rank","childNodes","from","childNode","drawPiece","parentGroup","pieceGroup","pieceUse","hidden","transformTranslate","visible","querySelector","enableMoveInput","eventHandler","enabled","disableMoveInput","moveInputCallbackResult","legalMove","assetsUrl","PIECES_FILE_TYPE","Chessboard","random","extensions","positionAnimationsQueue","extensionData","addExtension","initialized","setPosition","setOrientation","boardTurning","getPosition","getOrientation","isMoveInputEnabled","enableSquareSelect","eventType","squareSelectListener","disableSquareSelect","isSquareSelectEnabled","extensionClass","getExtension","extension","MARKER_TYPE","frame","dot","bevel","Markers","onRedrawBoard","autoMarkers","sprite","addMarker","getMarkers","removeMarkers","addLegalMovesMarkers","removeLegalMovesMarkers","markerGroupDown","markerGroupUp","markers","drawAutoMarkers","marker","drawMarker","moves","move","promotion","to","markerGroup","markerUse","Marker","markersFound","filter","events","audioProps","cmAudioDebug","createAudioContext","debug","AudioContext","webkitAudioContext","cmAudioContext","cmMainGainNode","createGain","gain","connect","destination","resumeAudioContext","Audio","setGain","setValueAtTime","currentTime","isEnabled","addStateListener","listener","removeEventListeners","resume","Sample","src","startWithoutAudioContext","gainNode","audioBuffer","load","play","when","offset","loading","createBufferSource","start","buffer","request","responseType","decodeAudioData","Level","initialFen","game","moveSound","blackPieceSquare","isValidMove","cursor","piecesLeft","levelFinished","validateRookMove","validateBishopMove","validateQueenMove","validateKnightMove","fileFrom","rankFrom","fileTo","rankTo","fileDiff","rankDiff","fileStep","rankStep","GameState","levelGroupName","marathonMode","level","MenuCheckpoint","localStorage","getItem","beatenLevels","Rook","Bishop","Knight","Queen","setItem","JSON","stringify","parse","bool","Confetti","shoot","defaults","origin","fire","particleRatio","opts","confetti","particleCount","spread","startVelocity","decay","scalar","LEVELS","Game","buttons","restartButton","menuButton","closebtn","restartLevel","openNav","closeNav","winSound","reloadUI","levelGroupNameOutput","levelNumberOutput","innerText","nextLevel","levelGroupsCount","levelGroupNames","currentLevelGroupNumber","display","location","currentLevel","currentCheckpoint","goBack","checkpoint"],"mappings":"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","x_google_ignoreList":[0,1,2,3,4,5,6,7,8,9,10,11]}